<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Aggregate Loss Models | Loss Data Analytics: Short Course</title>
  <meta name="description" content="This is an interactive, online, freely available short course. It will contain many interactive objects (quizzes, computer demonstrations, interactive graphs, video, and the like) to promote deeper learning." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Aggregate Loss Models | Loss Data Analytics: Short Course" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is an interactive, online, freely available short course. It will contain many interactive objects (quizzes, computer demonstrations, interactive graphs, video, and the like) to promote deeper learning." />
  <meta name="github-repo" content="https://github.com/OpenActTexts/LDACourse1" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Aggregate Loss Models | Loss Data Analytics: Short Course" />
  
  <meta name="twitter:description" content="This is an interactive, online, freely available short course. It will contain many interactive objects (quizzes, computer demonstrations, interactive graphs, video, and the like) to promote deeper learning." />
  

<meta name="author" content="A short course authored by the Actuarial Community" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-selection-and-estimation.html"/>

<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>

<!-- Various toggle functions used throughout --> 
<script language="javascript">
function toggle(id1,id2) {
	var ele = document.getElementById(id1); var text = document.getElementById(id2);
	if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Solution";}
		else {ele.style.display = "block"; text.innerHTML = "Hide Solution";}}
function togglecode(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show R Code";}
      else {ele.style.display = "block"; text.innerHTML = "Hide R Code";}}
function toggleEX(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Example";}
      else {ele.style.display = "block"; text.innerHTML = "Hide Example";}}
function toggleTheory(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Theory";}
      else {ele.style.display = "block"; text.innerHTML = "Hide Theory";}}
function toggleQuiz(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Quiz Solution";}
      else {ele.style.display = "block"; text.innerHTML = "Hide Quiz Solution";}}      
</script>

<!-- A few functions for revealing definitions -->
<script language="javascript">
<!--   $( function() {
    $("#tabs").tabs();
  } ); -->

$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
});

$(document).ready(function(){
    $('[data-toggle="popover"]').popover(); 
});
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K7GRETHNZH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-K7GRETHNZH');
</script>

<script language="javascript">
function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
}

// Get the element with id="defaultOpen" and click on it
document.getElementById("defaultOpen").click();
</script>

<script language="javascript">
function toggle(id1,id2) {
	var ele = document.getElementById(id1); var text = document.getElementById(id2);
	if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Solution";}
		else {ele.style.display = "block"; text.innerHTML = "Hide Solution";}}
</script>

<script language="javascript">
function togglecode(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show R Code";}
      else {ele.style.display = "block"; text.innerHTML = "Hide R Code";}}
</script>
<script language="javascript">
function toggleEX(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Example";}
      else {ele.style.display = "block"; text.innerHTML = "Hide Example";}}
</script>
<script language="javascript">
function toggleTheory(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Theory";}
      else {ele.style.display = "block"; text.innerHTML = "Hide Theory";}}
</script>

<script language="javascript">
function toggleDet(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Details";}
      else {ele.style.display = "block"; text.innerHTML = "Hide  Details";}}
</script>

<script language="javascript">
$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
});
</script>


<script>
$(document).ready(function(){
    $('[data-toggle="popover"]').popover(); 
});
</script>


<script src=https://cdn.datacamp.com/datacamp-light-latest.min.js></script>


<style>
/* Rearrange console label */
.datacamp-exercise ol li, .datacamp-exercise ul li {
  margin-bottom: 0em !important;
}

/* Remove bullet marker */
.datacamp-exercise ol li::before, .datacamp-exercise ul li::before {
  content: '' !important;
}
</style>


<script language="javascript">
var submitAnswer = function() {

  var radios = document.getElementsByName('choice');
  var val= "";
  for (var i = 0, length = radios.length; i < length; i++) {
      if (radios[i].checked) {
         val = radios[i].value; 
         break;
       }
  }
  
  if (val == "" ) {
    alert('please select choice answer');
  } else if ( val == "Correct" ) {
    alert('Answer is correct !');
  } else {
    alert('Answer is wrong');
  }
};
</script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K7GRETHNZH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-K7GRETHNZH');
</script>




<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Loss Data Analytics: Short Course</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-loss-data-analytics"><i class="fa fa-check"></i>Why Loss Data Analytics?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#resources"><i class="fa fa-check"></i>Resources</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-navigate-this-tutorial"><i class="fa fa-check"></i>How to Navigate this Tutorial</a></li>
<li><a href="index.html#a-word-from-our-sponsor-astin-education-astin-academy">A Word from our Sponsor: <br> Astin + Education = Astin Academy</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html"><i class="fa fa-check"></i><b>1</b> Introduction to Loss Data Analytics</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#Sec:Intro"><i class="fa fa-check"></i><b>1.1</b> Relevance of Analytics to Insurance Activities</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#Sec:PredModApps"><i class="fa fa-check"></i><b>1.2</b> Insurance Company Operations</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#Sec:LGPIF"><i class="fa fa-check"></i><b>1.3</b> Case Study: Property Fund Introduction</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#exercise.-claim-frequency"><i class="fa fa-check"></i><b>1.3.1</b> Exercise. Claim Frequency</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#Sec:PropertyFundSeverity"><i class="fa fa-check"></i><b>1.4</b> Property Fund Claim Severity</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#exercise.-exploring-claim-severities"><i class="fa fa-check"></i><b>1.4.1</b> Exercise. Exploring Claim Severities</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#exercise.-skewness-of-the-claim-severity-distribution"><i class="fa fa-check"></i><b>1.4.2</b> Exercise. Skewness of the Claim Severity Distribution</a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#exercise.-claim-severity-by-year"><i class="fa fa-check"></i><b>1.4.3</b> Exercise. Claim Severity by Year</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#Sec:LGPIFRatingVariaables"><i class="fa fa-check"></i><b>1.5</b> Property Fund Rating Variables</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#Ex:ClaimByType"><i class="fa fa-check"></i><b>1.5.1</b> Exercise. Claim by Entity Type, Fire Class, and No Claim Credit</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#contributors-1"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="frequency-modeling.html"><a href="frequency-modeling.html"><i class="fa fa-check"></i><b>2</b> Frequency Modeling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="frequency-modeling.html"><a href="frequency-modeling.html#basic-frequency-distributions"><i class="fa fa-check"></i><b>2.1</b> Basic Frequency Distributions</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-representing-the-number-of-cyber-events-with-a-binomial-distribution"><i class="fa fa-check"></i><b>2.1.1</b> Exercise. Representing the Number of Cyber Events with a Binomial Distribution</a></li>
<li class="chapter" data-level="2.1.2" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-representing-the-number-of-cyber-events-with-a-poisson-distribution"><i class="fa fa-check"></i><b>2.1.2</b> Exercise. Representing the Number of Cyber Events with a Poisson Distribution</a></li>
<li class="chapter" data-level="2.1.3" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-comparing-basic-count-distributions"><i class="fa fa-check"></i><b>2.1.3</b> Exercise. Comparing Basic Count Distributions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="frequency-modeling.html"><a href="frequency-modeling.html#the-ab0-class"><i class="fa fa-check"></i><b>2.2</b> The (a,b,0) Class</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-determining-probabilities-recursively"><i class="fa fa-check"></i><b>2.2.1</b> Exercise. Determining Probabilities Recursively</a></li>
<li class="chapter" data-level="2.2.2" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-reverse-engineering-and-recursive-r-functions"><i class="fa fa-check"></i><b>2.2.2</b> Exercise. Reverse Engineering and Recursive <code>R</code> Functions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="frequency-modeling.html"><a href="frequency-modeling.html#estimating-frequency-distributions"><i class="fa fa-check"></i><b>2.3</b> Estimating Frequency Distributions</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="frequency-modeling.html"><a href="frequency-modeling.html#Ex:CountDataCompression"><i class="fa fa-check"></i><b>2.3.1</b> Exercise. Count Data Compression - 1</a></li>
<li class="chapter" data-level="2.3.2" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-count-data-compression---2"><i class="fa fa-check"></i><b>2.3.2</b> Exercise. Count Data Compression - 2</a></li>
<li class="chapter" data-level="2.3.3" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-graphing-likelihoods"><i class="fa fa-check"></i><b>2.3.3</b> Exercise. Graphing Likelihoods</a></li>
<li class="chapter" data-level="2.3.4" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-fitting-a-binomial-distribution"><i class="fa fa-check"></i><b>2.3.4</b> Exercise. Fitting a Binomial Distribution</a></li>
<li class="chapter" data-level="2.3.5" data-path="frequency-modeling.html"><a href="frequency-modeling.html#Exer:FitNegBinomialDistrn"><i class="fa fa-check"></i><b>2.3.5</b> Exercise. Fitting a Negative Binomial Distribution</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="frequency-modeling.html"><a href="frequency-modeling.html#other-frequency-distributions"><i class="fa fa-check"></i><b>2.4</b> Other Frequency Distributions</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-the-ab1-distribution-and-its-moments"><i class="fa fa-check"></i><b>2.4.1</b> Exercise. The (<em>a,b</em>,1) Distribution and its Moments</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="frequency-modeling.html"><a href="frequency-modeling.html#mixture-distributions"><i class="fa fa-check"></i><b>2.5</b> Mixture Distributions</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-mixtures-of-workers-compensation-claims"><i class="fa fa-check"></i><b>2.5.1</b> Exercise. Mixtures of Workers’ Compensation Claims</a></li>
<li class="chapter" data-level="2.5.2" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-finite-number-of-mixture-distributions"><i class="fa fa-check"></i><b>2.5.2</b> Exercise. Finite Number of Mixture Distributions</a></li>
<li class="chapter" data-level="2.5.3" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-gamma-mixture-of-poissons"><i class="fa fa-check"></i><b>2.5.3</b> Exercise. Gamma Mixture of Poissons</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="frequency-modeling.html"><a href="frequency-modeling.html#goodness-of-fit"><i class="fa fa-check"></i><b>2.6</b> Goodness of Fit</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-goodness-of-fit-zero-modified-poisson"><i class="fa fa-check"></i><b>2.6.1</b> Exercise. Goodness of Fit: Zero-Modified Poisson</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="frequency-modeling.html"><a href="frequency-modeling.html#contributors-2"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html"><i class="fa fa-check"></i><b>3</b> Modeling Loss Severity</a>
<ul>
<li class="chapter" data-level="3.1" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#basic-distributional-quantities"><i class="fa fa-check"></i><b>3.1</b> Basic Distributional Quantities</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-moments-can-be-misleading"><i class="fa fa-check"></i><b>3.1.1</b> Exercise. Moments Can Be Misleading</a></li>
<li class="chapter" data-level="3.1.2" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-determining-boxplots-and-quantiles"><i class="fa fa-check"></i><b>3.1.2</b> Exercise. Determining Boxplots and Quantiles</a></li>
<li class="chapter" data-level="3.1.3" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-gamma-moment-generating-function"><i class="fa fa-check"></i><b>3.1.3</b> Exercise. Gamma Moment Generating Function</a></li>
<li class="chapter" data-level="3.1.4" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-visualizing-moment-generating-functions"><i class="fa fa-check"></i><b>3.1.4</b> Exercise. Visualizing Moment Generating Functions</a></li>
<li class="chapter" data-level="3.1.5" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-determining-moments-using-moment-generating-functions"><i class="fa fa-check"></i><b>3.1.5</b> Exercise. Determining Moments using Moment Generating Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#continuous-distributions"><i class="fa fa-check"></i><b>3.2</b> Continuous Distributions</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-visualizing-a-distribution-using-a-histogram"><i class="fa fa-check"></i><b>3.2.1</b> Exercise. Visualizing a Distribution using a Histogram</a></li>
<li class="chapter" data-level="3.2.2" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#Ex:VisualGamma"><i class="fa fa-check"></i><b>3.2.2</b> Exercise. Visualizing the Gamma Distribution</a></li>
<li class="chapter" data-level="3.2.3" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#Ex:CreateParetoDensityFct"><i class="fa fa-check"></i><b>3.2.3</b> Exercise. Creating a Pareto Density Function</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#methods-of-creating-new-distributions"><i class="fa fa-check"></i><b>3.3</b> Methods of Creating New Distributions</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-using-the-logarithmic-transformation-to-create-a-new-distribution"><i class="fa fa-check"></i><b>3.3.1</b> Exercise. Using the Logarithmic Transformation to Create a New Distribution</a></li>
<li class="chapter" data-level="3.3.2" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-creating-a-mixture-distribution"><i class="fa fa-check"></i><b>3.3.2</b> Exercise. Creating a Mixture Distribution</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#coverage-modifications"><i class="fa fa-check"></i><b>3.4</b> Coverage Modifications</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-calculate-moments-of-the-lognormal-distribution"><i class="fa fa-check"></i><b>3.4.1</b> Exercise. Calculate Moments of the Lognormal Distribution</a></li>
<li class="chapter" data-level="3.4.2" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-calculate-limited-expected-value-of-the-lognormal-distribution"><i class="fa fa-check"></i><b>3.4.2</b> Exercise. Calculate Limited Expected Value of the Lognormal Distribution</a></li>
<li class="chapter" data-level="3.4.3" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-expected-claims-subject-to-a-deductible"><i class="fa fa-check"></i><b>3.4.3</b> Exercise. Expected Claims Subject to a Deductible</a></li>
<li class="chapter" data-level="3.4.4" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-expected-claims-subject-to-a-deductible-and-coinsurance"><i class="fa fa-check"></i><b>3.4.4</b> Exercise. Expected Claims Subject to a Deductible and Coinsurance</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#maximum-likelihood-estimation"><i class="fa fa-check"></i><b>3.5</b> Maximum Likelihood Estimation</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#Ex:MLEPareto"><i class="fa fa-check"></i><b>3.5.1</b> Exercise. Maximum Likelihood Estimation for a Pareto Distribution</a></li>
<li class="chapter" data-level="3.5.2" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-finding-standard-errors-for-maximum-likelihood-estimates"><i class="fa fa-check"></i><b>3.5.2</b> Exercise. Finding Standard Errors for Maximum Likelihood Estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#contributors-3"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html"><i class="fa fa-check"></i><b>4</b> Model Selection and Estimation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#Sec:NonInf"><i class="fa fa-check"></i><b>4.1</b> Nonparametric Inference</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-empirical-distribution-function-and-quartiles-percentiles-and-quantiles"><i class="fa fa-check"></i><b>4.1.1</b> Exercise. Empirical Distribution Function and Quartiles, Percentiles and Quantiles</a></li>
<li class="chapter" data-level="4.1.2" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-density-estimators"><i class="fa fa-check"></i><b>4.1.2</b> Exercise. Density Estimators</a></li>
<li class="chapter" data-level="4.1.3" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-comparing-poisson-and-negative-binomial-distributions"><i class="fa fa-check"></i><b>4.1.3</b> Exercise. Comparing Poisson and Negative Binomial Distributions</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#tools-for-model-selection"><i class="fa fa-check"></i><b>4.2</b> Tools for Model Selection</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#Ex:PPPlot"><i class="fa fa-check"></i><b>4.2.1</b> Exercise. Probability-Probability (<span class="math inline">\(pp\)</span>) plot</a></li>
<li class="chapter" data-level="4.2.2" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-quantile-quantile-qq-plot"><i class="fa fa-check"></i><b>4.2.2</b> Exercise. Quantile-Quantile (<span class="math inline">\(qq\)</span>) plot</a></li>
<li class="chapter" data-level="4.2.3" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-kolmogorov-smirnov-statistic"><i class="fa fa-check"></i><b>4.2.3</b> Exercise. Kolmogorov-Smirnov statistic</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#model-selection-likelihood-ratio-tests-and-goodness-of-fit"><i class="fa fa-check"></i><b>4.3</b> Model Selection: Likelihood Ratio Tests and Goodness of Fit</a></li>
<li class="chapter" data-level="4.4" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#estimation-using-modified-data-nonparametric-approach"><i class="fa fa-check"></i><b>4.4</b> Estimation using Modified Data: Nonparametric Approach</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#Ex:KMEstimation"><i class="fa fa-check"></i><b>4.4.1</b> Exercise. Kaplan-Meier Estimation based on Censored Data</a></li>
<li class="chapter" data-level="4.4.2" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-nonparametric-estimation-using-truncated-and-censored-information"><i class="fa fa-check"></i><b>4.4.2</b> Exercise. Nonparametric Estimation using Truncated and Censored Information</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#estimation-using-modified-data-parametric-approach"><i class="fa fa-check"></i><b>4.5</b> Estimation using Modified Data: Parametric Approach</a></li>
<li class="chapter" data-level="4.6" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#bayesian-inference"><i class="fa fa-check"></i><b>4.6</b> Bayesian Inference</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#visualizing-bayesian-methods"><i class="fa fa-check"></i><b>4.6.1</b> Visualizing Bayesian Methods</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#contributors-4"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html"><i class="fa fa-check"></i><b>5</b> Aggregate Loss Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#individual-risk-model"><i class="fa fa-check"></i><b>5.2</b> Individual Risk Model</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#Ex:IRM1"><i class="fa fa-check"></i><b>5.2.1</b> Exercise. Simulating Claim Frequency</a></li>
<li class="chapter" data-level="5.2.2" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#exercise.-individual-risk-model"><i class="fa fa-check"></i><b>5.2.2</b> Exercise. Individual Risk Model</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#Sec:CollRisk1"><i class="fa fa-check"></i><b>5.3</b> Fitting a Collective Risk Model in Two Parts</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#Ex:FreqCollectRM"><i class="fa fa-check"></i><b>5.3.1</b> Exercise. Estimating the Frequency Component of the Collective Risk Model</a></li>
<li class="chapter" data-level="5.3.2" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#exercise.-estimating-the-severity-component-of-the-collective-risk-model"><i class="fa fa-check"></i><b>5.3.2</b> Exercise. Estimating the Severity Component of the Collective Risk Model</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#computation-strategies-for-a-collective-risk-model"><i class="fa fa-check"></i><b>5.4</b> Computation Strategies for a Collective Risk Model</a></li>
<li class="chapter" data-level="5.5" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#tweedie-distribution"><i class="fa fa-check"></i><b>5.5</b> Tweedie Distribution</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#exercise.-fitting-a-tweedie-distribution"><i class="fa fa-check"></i><b>5.5.1</b> Exercise. Fitting a Tweedie Distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#effects-of-coverage-modifications"><i class="fa fa-check"></i><b>5.6</b> Effects of Coverage Modifications</a></li>
<li class="chapter" data-level="" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#contributors-5"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/OpenActTexts/LDACourse1/" target="blank">LDA Short Course on GitHub</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Loss Data Analytics: Short Course</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="aggregate-loss-models" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Aggregate Loss Models</h1>
<p><strong>Chapter Description</strong></p>
<p>This chapter introduces probability models for describing the aggregate (total) claims that arise from a portfolio of insurance contracts. We present two standard modeling approaches, the individual risk model and the collective risk model. Further, we discuss strategies for computing the distribution of the aggregate claims, including exact methods for special cases, recursion, and simulation. Finally, we examine the effects of individual policy modifications such as deductibles, coinsurance, and inflation, on the frequency and severity distributions, and thus on the aggregate loss distribution.</p>
<div class="blackbox">
<ul>
<li>Although not needed to go through the tutorials, some users may wish to download the overheads that the videos are based on. <button download><a href="https://raw.githubusercontent.com/OpenActTexts/LDACourse1/main/LDA1.Overheads/LDA1.Chap5.pdf">Download Chapter Five overheads as a .pdf file.</a></button></li>
<li>By watching the videos and working through the tutorial exercises, you will get an appreciation for aggregate loss models. For a deeper dive, see the corresponding chapter in the textbook, <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-AggLossModels.html">Chapter Five of <em>Loss Data Analytics</em></a>.</li>
</ul>
</div>
<div id="introduction" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Introduction</h2>
<hr />
<p>In this section, we learn how to:</p>
<ul>
<li>Record aggregate losses from an insurance system.</li>
<li>Identify actuarial applications of aggregate loss models.</li>
</ul>
<hr />
<div id="video-introduction-to-aggregate-loss-models" class="section level4 unnumbered">
<h4>Video: Introduction to Aggregate Loss Models</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_bock2cl4&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_1bqvxhby" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-introduction-to-aggregate-loss-models-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Introduction to Aggregate Loss Models (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect51A')">A. Basic Terminology</button>
<button class="tablinks" onclick="openTab(event, 'Sect51B')">B. Goal</button>
<button class="tablinks" onclick="openTab(event, 'Sect51C')">C. Models</button>
<button class="tablinks" onclick="openTab(event, 'Sect51D')">D. Example</button>
<button class="tablinks" onclick="openTab(event, 'Sect51E')">E. Applications</button>
</div>
<div id="Sect51A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=3" width="100%" height="400"> </iframe>
</div>
<div id="Sect51B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=4" width="100%" height="400"> </iframe>
</div>
<div id="Sect51C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=5" width="100%" height="400"> </iframe>
</div>
<div id="Sect51D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=7" width="100%" height="400"> </iframe>
</div>
<div id="Sect51E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=8" width="100%" height="400"> </iframe>
</div>
</div>
</div>
<div id="individual-risk-model" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Individual Risk Model</h2>
<hr />
<p>In this section, we learn how to:</p>
<ul>
<li>Build an individual risk model for a portfolio of insurance contracts.</li>
<li>Apply the individual risk model to life and nonlife insurance.</li>
<li>Compute the distribution of aggregate losses from an individual risk model.</li>
</ul>
<hr />
<div id="video-individual-risk-model" class="section level4 unnumbered">
<h4>Video: Individual Risk Model</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_ndjyp3ql&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_ivcxtqyq" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-individual-risk-model-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Individual Risk Model (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect52A')">A. Individual Risk Model</button>
<button class="tablinks" onclick="openTab(event, 'Sect52B')">B. Applications</button>
<button class="tablinks" onclick="openTab(event, 'Sect52C')">C. Example</button>
<button class="tablinks" onclick="openTab(event, 'Sect52D')">D. Aggregate Loss Distribution</button>
<button class="tablinks" onclick="openTab(event, 'Sect52E')">E. R Example #1</button>
<button class="tablinks" onclick="openTab(event, 'Sect52F')">F. R Example #2</button>
</div>
<div id="Sect52A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=10" width="100%" height="400"> </iframe>
</div>
<div id="Sect52B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=11" width="100%" height="400"> </iframe>
</div>
<div id="Sect52C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=13" width="100%" height="400"> </iframe>
</div>
<div id="Sect52D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=15" width="100%" height="400"> </iframe>
</div>
<div id="Sect52E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=16" width="100%" height="400"> </iframe>
</div>
<div id="Sect52F" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=17" width="100%" height="400"> </iframe>
</div>
</div>
<div id="Ex:IRM1" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Exercise. Simulating Claim Frequency</h3>
<p><strong>Assignment Text</strong></p>
<p>In this assignment, we revisit <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-AggLossModels.html">Example 5.2.1 of <em>Loss Data Analytics</em></a> using <em>simulation</em> in <code>R</code>. Even though we “officially” start to work with simulation beginning in <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-Simulation.html">Chapter 6 in <em>Loss Data Analytics</em></a>, this exercise provides you with an opportunity to taste a flavor of simulation.</p>
<div class="blackbox">
<p><strong>Instructions</strong></p>
<ul>
<li>Use the function <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/Binomial">rbinom()</a> to simulate the number of claims that follow binomial distribution. For reproducibility of results set the initial ‘seed’ as <code>1000</code> and then generate 10,000 observations of claim frequencies for each group of policies.</li>
<li>Specify the size and probability when you simulate the number of claims with binomial distribution in each group of policies.</li>
</ul>
</div>
<p><br></p>
<div data-datacamp-exercise="" data-height="300" data-encoded="true">
eyJsYW5ndWFnZSI6InIiLCJzYW1wbGUiOiJzZXQuc2VlZCg/PykgICAgIFxuciAgPC0gPz8gICAgICAgICBcbnExIDwtIDAuMDUgICAgICAgICBcbnEyIDwtID8/ICAgICAgICAgXG5uMSA8LSA/PyAgICAgICAgIFxubjIgPC0gMjAwICAgICAgICAgIFxuXG5uMSA8LSByYmlub20ociwgc2l6ZT1uMSwgcHJvYj1xMSkgXG5uMiA8LSByYmlub20ociwgc2l6ZT0/PywgcHJvYj0/PykgIiwic29sdXRpb24iOiJzZXQuc2VlZCgxMDAwKSAgICAgIyBGb3IgcmVwcm9kdWNpYmlsaXR5IG9mIHJlc3VsdHNcbnIgIDwtIDEwMDAwICAgICAgICAjIE51bWJlciBvZiBvYnNlcnZhdGlvbnMgdG8gc2ltdWxhdGUgZm9yIGVhY2ggcG9saWN5XG5xMSA8LSAwLjA1ICAgICAgICAgIyBQcm9iYWJpbGl0eSBvZiBjbGFpbSBmcm9tIHBvbGljeSAxXG5xMiA8LSAwLjA2ICAgICAgICAgIyBQcm9iYWJpbGl0eSBvZiBjbGFpbSBmcm9tIHBvbGljeSAyXG5uMSA8LSAxMDAgICAgICAgICAgIyBOdW1iZXIgb2YgdHlwZSAxIHBvbGljaWVzXG5uMiA8LSAyMDAgICAgICAgICAgIyBOdW1iZXIgb2YgdHlwZSAyIHBvbGljaWVzXG5cbm4xIDwtIHJiaW5vbShyLCBzaXplPW4xLCBwcm9iPXExKSAjIEdlbmVyYXRlIHI9MTAwMDAgb2JzZXJ2YXRpb25zIG9mIE4xIGZyb20gQmlub21pYWxcbm4yIDwtIHJiaW5vbShyLCBzaXplPW4yLCBwcm9iPXEyKSAjIEdlbmVyYXRlIHI9MTAwMDAgb2JzZXJ2YXRpb25zIG9mIE4yIGZyb20gQmlub21pYWwiLCJzY3QiOiJuMW1zZyA8LSBcIkRpZCB5b3UgY29ycmVjdGx5IHNwZWNpZnkgdGhlIG9iamVjdCBgbjFgP1wiXG5leCgpICU+JSBjaGVja19vYmplY3QoXCJuMVwiLCB1bmRlZmluZWRfbXNnID0gXCJNYWtlIHN1cmUgdG8gbm90IHJlbW92ZSBgbjFgIVwiKSAlPiUgY2hlY2tfZXF1YWwoaW5jb3JyZWN0X21zZz1uMW1zZylcbm4ybXNnIDwtIFwiRGlkIHlvdSBjb3JyZWN0bHkgc3BlY2lmeSB0aGUgb2JqZWN0IGBuMmA/XCJcbmV4KCkgJT4lIGNoZWNrX29iamVjdChcIm4yXCIsIHVuZGVmaW5lZF9tc2cgPSBcIk1ha2Ugc3VyZSB0byBub3QgcmVtb3ZlIGBuMmAhXCIpICU+JSBjaGVja19lcXVhbChpbmNvcnJlY3RfbXNnPW4ybXNnKVxuc3VjY2Vzc19tc2coXCJHb29kIGpvYiEgSW4gQ2hhcHRlciAyLCB3ZSByZXZpZXdlZCBmcmVxdWVuY3kgbW9kZWxpbmcuIFRoaXMgdHV0b3JpYWwgaW50cm9kdWNlcyBzaW11bGF0aW9uIHRlY2huaXF1ZXMgdGhhdCBjb25zaWRlcmFibHkgZW5oYWNlIHRoZSBicmVhZHRoIG9mIGFjdHVhcmlhbCBhcHBsaWNhdGlvbnMuIEFzIG5vdGVkIGluIHRoZSBhc3NpZ25tZW50IHRleHQgb2YgdGhpcyB0dXRvcmlhbCwgeW91IGNhbiBjaGVjayBvdXQgQ2hhcHRlciA2IG9mIExvc3MgRGF0YSBBbmFseXRpY3MgZm9yIG1vcmUgYmFja2dyb3VuZCBvbiBzaW11bGF0aW9uIHRlY2huaXF1ZXMuXCIpIiwiaGludCI6Ik5vdGUgdGhhdCBudW1iZXIgb2YgcG9saWNpZXMgYW5kIHByb2JhYmlsaXR5IG9mIGNsYWltIHBlciBwb2xpY3kgY29ycmVzcG9uZCB0byB0aGUgc2l6ZSBhbmQgaW5jaWRlbmNlIHByb2JhYmlsaXR5IGluIGEgYmlub21pYWwgZGlzdHJpYnV0aW9uIGZvciBhIGNsYWltIGZyZXF1ZW5jeSByYW5kb20gdmFyaWFibGUuIn0=
</div>
</div>
<div id="exercise.-individual-risk-model" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Exercise. Individual Risk Model</h3>
<p><strong>Assignment Text</strong></p>
<p>Continuing our work in Exercise <a href="aggregate-loss-models.html#Ex:IRM1">5.2.1</a>, we now reproduce the theoretical results for calculation of moments in individual risk models using simulation. We use the simulated frequencies for each group of policies from Exercise <a href="aggregate-loss-models.html#Ex:IRM1">5.2.1</a> and continue to simulate compound losses in an individual risk model as elaborated in <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-AggLossModels.html#computing-the-aggregate-claims-distribution">Section 5.4.2 on <em>Loss Data Analytics</em></a>.</p>
<div class="blackbox">
<p><strong>Instructions</strong></p>
<ul>
<li>Use the function <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/Uniform">runif()</a> to claim amounts that follow <em>uniform</em> distribution for each group of policies.</li>
<li>Specify the parameters of uniform random variables, minimum and maximum values of claim amounts from each type of policies.</li>
<li>Initialize an empty vector of length <span class="math inline">\(R\)</span> to store <span class="math inline">\(R\)</span> observations of simulated <span class="math inline">\(S\)</span>. In each simulation, calculate the <span class="math inline">\(j\)</span>th simulated aggregate loss and store it in <span class="math inline">\(j\)</span>th component of <span class="math inline">\(S\)</span> for <span class="math inline">\(j=1, \ldots, R\)</span>.</li>
<li>Compute the mean and variance of <span class="math inline">\(S\)</span> by simulation using <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean">mean()</a> and <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/cor">var()</a>. Then, compare these values to their corresponding theoretical values, 2,800 and 600,467, respectively.</li>
<li>Produce a visual summary of the distribution of <span class="math inline">\(S\)</span> using the histogram function, <a href="https://www.rdocumentation.org/packages/graphics/versions/3.6.2/topics/hist">hist()</a> .</li>
</ul>
</div>
<p><br></p>
<div data-datacamp-exercise="" data-height="300" data-encoded="true">
eyJsYW5ndWFnZSI6InIiLCJwcmVfZXhlcmNpc2VfY29kZSI6InNldC5zZWVkKDEwMDApICAgICAjIEZvciByZXByb2R1Y2liaWxpdHkgb2YgcmVzdWx0c1xuciAgPC0gMTAwMDAgICAgICAgICMgTnVtYmVyIG9mIG9ic2VydmF0aW9ucyB0byBzaW11bGF0ZSBmb3IgZWFjaCBwb2xpY3lcbnExIDwtIDAuMDUgICAgICAgICAjIFByb2JhYmlsaXR5IG9mIGNsYWltIGZyb20gcG9saWN5IDFcbnEyIDwtIDAuMDYgICAgICAgICAjIFByb2JhYmlsaXR5IG9mIGNsYWltIGZyb20gcG9saWN5IDJcbm4xIDwtIDEwMCAgICAgICAgICAjIE51bWJlciBvZiB0eXBlIDEgcG9saWNpZXNcbm4yIDwtIDIwMCAgICAgICAgICAjIE51bWJlciBvZiB0eXBlIDIgcG9saWNpZXNcblxubjEgPC0gcmJpbm9tKHIsIHNpemU9bjEsIHByb2I9cTEpICMgR2VuZXJhdGUgcj0xMDAwMCBvYnNlcnZhdGlvbnMgb2YgTjEgZnJvbSBCaW5vbWlhbFxubjIgPC0gcmJpbm9tKHIsIHNpemU9bjIsIHByb2I9cTIpICMgR2VuZXJhdGUgcj0xMDAwMCBvYnNlcnZhdGlvbnMgb2YgTjIgZnJvbSBCaW5vbWlhbCIsInNhbXBsZSI6InNldC5zZWVkKDEwMDApICAgICBcbnIgIDwtIDEwMDAwICAgICAgICBcbm0xIDwtIDA7ICBNMSA8LSA/PyBcbm0yIDwtID8/OyBNMiA8LSAzMDAgXG4jIG4xOiBHZW5lcmF0ZWQgMTAwMDAgb2JzZXJ2YXRpb25zIG9mIGNsYWltIGZyZXF1ZW5jeSBmcm9tIHRoZSBmaXJzdCAgZ3JvdXAgb2YgcG9saWNpZXMgd2l0aCBCaW5vbWlhbFxuIyBuMjogR2VuZXJhdGVkIDEwMDAwIG9ic2VydmF0aW9ucyBvZiBjbGFpbSBmcmVxdWVuY3kgZnJvbSB0aGUgc2Vjb25kIGdyb3VwIG9mIHBvbGljaWVzIHdpdGggQmlub21pYWxcblMgPC0gcmVwKD8/LCByKSBcblxuZm9yKGogaW4gMTpyKSB7IFxuICB4MV9qIDwtIHJ1bmlmKG4xW2pdLCBtaW49bTEsIG1heD0/PylcbiAgeDJfaiA8LSBydW5pZig/PywgbWluPT8/LCBtYXg9TTIpXG4gIFNbal0gPC0gc3VtKHgxX2opK3N1bSg/Pylcbn1cbj8/KFMpIFxudmFyKD8/KVxuPz8oUykiLCJzb2x1dGlvbiI6InNldC5zZWVkKDEwMDApICAgICAjIEZvciByZXByb2R1Y2liaWxpdHkgb2YgcmVzdWx0c1xuciAgPC0gMTAwMDAgICAgICAgICMgTnVtYmVyIG9mIG9ic2VydmF0aW9ucyB0byBzaW11bGF0ZSBmb3IgZWFjaCBwb2xpY3lcbm0xIDwtIDA7IE0xIDwtIDQwMCAjIFBhcmFtZXRlcnMgZm9yIHNldmVyaXR5IGRpc3RyaWJ1dGlvbiBYXzFcbm0yIDwtIDA7IE0yIDwtIDMwMCAjIFBhcmFtZXRlcnMgZm9yIHNldmVyaXR5IGRpc3RyaWJ1dGlvbiBYXzJcbiMgbjE6IEdlbmVyYXRlZCAxMDAwMCBvYnNlcnZhdGlvbnMgb2YgY2xhaW0gZnJlcXVlbmN5IGZyb20gdGhlIGZpcnN0ICBncm91cCBvZiBwb2xpY2llcyB3aXRoIEJpbm9taWFsXG4jIG4yOiBHZW5lcmF0ZWQgMTAwMDAgb2JzZXJ2YXRpb25zIG9mIGNsYWltIGZyZXF1ZW5jeSBmcm9tIHRoZSBzZWNvbmQgZ3JvdXAgb2YgcG9saWNpZXMgd2l0aCBCaW5vbWlhbFxuUyA8LSByZXAoTkEsIHIpICMgSW5pdGlhbGl6ZSBhbiBlbXB0eSB2ZWN0b3IgdG8gc3RvcmUgUyBvYnNlcnZhdGlvbnNcblxuZm9yKGogaW4gMTpyKSB7IFxuICB4MV9qIDwtIHJ1bmlmKG4xW2pdLCBtaW49bTEsIG1heD1NMSlcbiAgeDJfaiA8LSBydW5pZihuMltqXSwgbWluPW0yLCBtYXg9TTIpXG4gIFNbal0gIDwtIHN1bSh4MV9qKStzdW0oeDJfaikgIyBDYWxjdWxhdGUganRoIHNpbXVsYXRlZCBhZ2dyZWdhdGUgbG9zcyBhbmQgc3RvcmUgaXQgYXQgU1tqXVxufVxubWVhbihTKSAjIENvbXBhcmUgdG8gdGhlb3JldGljYWwgdmFsdWUgb2YgMiw4MDBcbnZhcihTKSAgIyBDb21wYXJlIHRvIHRoZW9yZXRpY2FsIHZhbHVlIG9mIDYwMCw0Njdcbmhpc3QoUykiLCJzY3QiOiJNMW1zZyA8LSBcIkRpZCB5b3UgY29ycmVjdGx5IHNwZWNpZnkgdGhlIG9iamVjdCBgTTFgP1wiXG5leCgpICU+JSBjaGVja19vYmplY3QoXCJNMVwiLCB1bmRlZmluZWRfbXNnID0gXCJNYWtlIHN1cmUgdG8gbm90IHJlbW92ZSBgTTFgIVwiKSAlPiUgY2hlY2tfZXF1YWwoaW5jb3JyZWN0X21zZz1NMW1zZylcbm4ybXNnIDwtIFwiRGlkIHlvdSBjb3JyZWN0bHkgc3BlY2lmeSB0aGUgb2JqZWN0IGBuMmA/XCJcbmV4KCkgJT4lIGNoZWNrX29iamVjdChcIm4yXCIsIHVuZGVmaW5lZF9tc2cgPSBcIk1ha2Ugc3VyZSB0byBub3QgcmVtb3ZlIGBuMmAhXCIpICU+JSBjaGVja19lcXVhbChpbmNvcnJlY3RfbXNnPW4ybXNnKVxuc3VjY2Vzc19tc2coXCJHb29kIGpvYiEgRGVzcGl0ZSB0aGUgc2VlbWluZyBzaW1wbGljaXR5IG9mIHRoaXMgZXhhbXBsZSAod2l0aCB1bmlmb3JtIHNpemUgZGlzdHJpYnV0aW9ucyksIGNvbXB1dGluZyB0aGUgZGlzdHJpYnV0aW9uIG9mIGNsYWltcyBTIGlzIGF0IGJlc3QgdGVkaW91cyB3aGVuIHVzaW5nIGV4YWN0IG1ldGhvZHMuIFlvdSBjYW4gdXNlIHNpbXVsYXRpb24gdG8gcXVpY2tseSBnZXQgYSBzZW5zZSBvZiB0aGUgZGlzdHJpYnV0aW9uIGFuZCB1c2UgdGhpcyBhcyBhIGJhc2UgYXMgeW91IGFkanVzdCB0aGUgbW9kZWwgdG8gbWFrZSBpdCBiZXR0ZXIgc3VpdGVkIHRvIGFwcHJveGltYXRlIGFuIGFjdHVhcmlhbCBhcHBsaWNhdGlvbiBvZiBpbnRlcmVzdC5cIikiLCJoaW50IjoiTm90ZSB0aGF0IHdlIG5lZWQgdG8gc2ltdWxhdGUgY2xhaW0gYW1vdW50cyB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoZSBudW1iZXIgb2YgY2xhaW1zIHNvIHRoYXQgdGhlIHBhcmFtZXRlcnMgdXNlZCBpbiA8Y29kZT5ydW5pZigpPC9jb2RlPiBmdW5jdGlvbiBtYXkgZGVwZW5kIG9uIHRoZSBudW1iZXIgb2Ygc2ltdWxhdGVkIGNsYWltcy4ifQ==
</div>
</div>
</div>
<div id="Sec:CollRisk1" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Fitting a Collective Risk Model in Two Parts</h2>
<hr />
<p>In this section, we learn how to:</p>
<ul>
<li>Build a collective risk model for a portfolio of insurance contracts.</li>
<li>Calculate the mean and variance of the aggregate loss.</li>
<li>Fit frequency and severity components in a collective risk model.</li>
</ul>
<hr />
<div id="video-fitting-a-two-part-collective-risk-model" class="section level4 unnumbered">
<h4>Video: Fitting a Two Part Collective Risk Model</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_w76qa2ja&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_g39djg7z" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-fitting-a-two-part-collective-risk-model-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Fitting a Two Part Collective Risk Model (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect531A')">A. Collective Risk Model</button>
<button class="tablinks" onclick="openTab(event, 'Sect531B')">B. Compound Distribution</button>
<button class="tablinks" onclick="openTab(event, 'Sect531C')">C. Moments</button>
<button class="tablinks" onclick="openTab(event, 'Sect531D')">D. Model Fitting</button>
<button class="tablinks" onclick="openTab(event, 'Sect531E')">E. Model Fitting - Property Fund</button>
</div>
<div id="Sect531A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=20" width="100%" height="400"> </iframe>
</div>
<div id="Sect531B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=21" width="100%" height="400"> </iframe>
</div>
<div id="Sect531C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=22" width="100%" height="400"> </iframe>
</div>
<div id="Sect531D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=23" width="100%" height="400"> </iframe>
</div>
<div id="Sect531E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=24" width="100%" height="400"> </iframe>
</div>
</div>
<div id="Ex:FreqCollectRM" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Exercise. Estimating the Frequency Component of the Collective Risk Model</h3>
<p><strong>Assignment Text</strong></p>
<p>In this exercise and the next, you will use data to calibrate the frequency and severity components of the collective risk model. The basis for this is the <strong>LGPIF</strong> data, introduced in Section <a href="introduction-to-loss-data-analytics.html#Sec:LGPIF">1.3</a> and used in many exercises.</p>
<p>In this assignment, we fit a <em>negative binomial</em> distribution to the frequency component. You may wish to review Exercise <a href="frequency-modeling.html#Exer:FitNegBinomialDistrn">2.3.5</a> where we fit a negative binomial distribution to a small synthetic data set.</p>
<div class="blackbox">
<p><strong>Instructions</strong></p>
<ul>
<li>Restrict the sample to the subset of towns and identify the claims counts as a global variable <span class="math inline">\(N\)</span>.</li>
<li>Construct a function to determine the negative log-likelihood. Do this based on the probability mass function for the negative binomial distribution, <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/NegBinomial">dnbinom()</a>. Note that we use the same parametrization as in the <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-Frequency-Modeling.html#S:important-frequency-distributions">Section 2.2 of <em>Loss Data Analytics</em></a> so that <span class="math inline">\(\text{size}=r\)</span> and <span class="math inline">\(\text{prob}=1/(1+\beta)\)</span>.</li>
<li>Determine initial, or starting, values for the algorithm using the method of moments.</li>
<li>Use the function <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/optim">optim()</a> to find the maximum likelihood estimates of the frequency distribution.</li>
<li>Provide a table to compare the empirical distribution to the fitted negative binomial distribution.</li>
</ul>
</div>
<p><br></p>
<div data-datacamp-exercise="" data-height="300" data-encoded="true">
eyJsYW5ndWFnZSI6InIiLCJwcmVfZXhlcmNpc2VfY29kZSI6Ikluc2FtcGxlIDwtIHJlYWQuY3N2KFwiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL09wZW5BY3RUZXh0cy9MREFDb3Vyc2UxL21haW4vRGF0YS9JbnNhbXBsZS5jc3ZcIiwgaGVhZGVyPVQsIG5hLnN0cmluZ3M9YyhcIi5cIiksIHN0cmluZ3NBc0ZhY3RvcnM9RkFMU0UpXG5saWJyYXJ5KGxtZTQpIiwic2FtcGxlIjoiSW5zYW1wbGVUb3duIDwtIHN1YnNldChJbnNhbXBsZSwgVHlwZVRvd249PTEpXG5OIDwtIEluc2FtcGxlVG93biRGcmVxXG4jIFRoZSBuZWdhdGl2ZSBMb2cgLSBsaWtlbGlob29kXG5mcmVxX2xpayA8LSBmdW5jdGlvbihwYXJtKSB7XG4gIHIgICAgPC0gcGFybVsxXVxuICBiZXRhIDwtIHBhcm1bMl1cbiAgbGlrICA8LSAtc3VtKGRuYmlub20oTiwgc2l6ZT0gPz8sIHByb2I9MS8oMSs/PyksIGxvZz1UUlVFKSlcbiAgcmV0dXJuKGxpaykgfVxuIyBpbml0aWFsIGVzdGltYXRlcyBieSBtZXRob2Qgb2YgbW9tZW50c1xuaW5pdC5wYXJtLmZyZXEgPC0gYyhtZWFuKE4pLyh2YXIoTikvbWVhbihOKS0xKSwgdmFyKE4pL21lYW4oTiktMSkgXG4jIE1heGltdW0gbGlrZWxpaG9vZCBlc3RpbWF0aW9uIGZvciB0aGUgZnJlcXVlbmN5IG1vZGVsXG5mcmVxX21vZCAgICAgICA8LSA/PyhwYXI9aW5pdC5wYXJtLmZyZXEsIGZuPT8/KSBcbnIuZXN0ICAgIDwtIGZyZXFfbW9kJHBhclsxXVxuYmV0YS5lc3QgPC0gZnJlcV9tb2QkcGFyWzJdXG4jIEVtcGlyaWNhbCBhbmQgZml0dGVkIGRpc3RyaWJ1dGlvbnMgb2Ygb2JzZXJ2ZWQgTlxuZnJlcV90YWJsZSA8LSBjYmluZCh0YWJsZShOKVsxOjRdL2xlbmd0aChOKSwgZG5iaW5vbSgwOjMsIHNpemU9Pz8sIHByb2I9MS8oMStiZXRhLmVzdCkpKVxuZnJlcV90YWJsZSA8LSByYmluZChmcmVxX3RhYmxlLCAxLWNvbFN1bXMoZnJlcV90YWJsZSkpICMgc28gcHJvYnMgc3VtIHRvIG9uZVxucm93bmFtZXMoZnJlcV90YWJsZSlbNV0gPC0gXCI0K1wiXG5jb2xuYW1lcyhmcmVxX3RhYmxlKSA8LSBjKFwiRW1waXJpY2FsXCIsIFwiRml0dGVkXCIpXG5yb3VuZChmcmVxX3RhYmxlLCBkaWdpdHMgPSA2KSIsInNvbHV0aW9uIjoiSW5zYW1wbGVUb3duIDwtIHN1YnNldChJbnNhbXBsZSwgVHlwZVRvd249PTEpXG5OIDwtIEluc2FtcGxlVG93biRGcmVxXG4jIFRoZSBuZWdhdGl2ZSBMb2cgLSBsaWtlbGlob29kXG5mcmVxX2xpayA8LSBmdW5jdGlvbihwYXJtKSB7XG4gIHIgICAgPC0gcGFybVsxXVxuICBiZXRhIDwtIHBhcm1bMl1cbiAgbGlrICA8LSAtc3VtKGRuYmlub20oTiwgc2l6ZT1yLCBwcm9iPTEvKDErYmV0YSksIGxvZz1UUlVFKSlcbiAgcmV0dXJuKGxpaykgfVxuIyBpbml0aWFsIGVzdGltYXRlcyBieSBtZXRob2Qgb2YgbW9tZW50c1xuaW5pdC5wYXJtLmZyZXEgPC0gYyhtZWFuKE4pLyh2YXIoTikvbWVhbihOKS0xKSwgdmFyKE4pL21lYW4oTiktMSkgXG4jIE1heGltdW0gbGlrZWxpaG9vZCBlc3RpbWF0aW9uIGZvciB0aGUgZnJlcXVlbmN5IG1vZGVsXG5mcmVxX21vZCAgICAgICA8LSBvcHRpbShwYXI9aW5pdC5wYXJtLmZyZXEsIGZuPWZyZXFfbGlrKSBcbnIuZXN0ICAgIDwtIGZyZXFfbW9kJHBhclsxXVxuYmV0YS5lc3QgPC0gZnJlcV9tb2QkcGFyWzJdXG4jIEVtcGlyaWNhbCBhbmQgZml0dGVkIGRpc3RyaWJ1dGlvbnMgb2Ygb2JzZXJ2ZWQgTlxuZnJlcV90YWJsZSA8LSBjYmluZCh0YWJsZShOKVsxOjRdL2xlbmd0aChOKSwgZG5iaW5vbSgwOjMsIHNpemU9ci5lc3QsIHByb2I9MS8oMStiZXRhLmVzdCkpKVxuZnJlcV90YWJsZSA8LSByYmluZChmcmVxX3RhYmxlLCAxLWNvbFN1bXMoZnJlcV90YWJsZSkpICMgc28gcHJvYnMgc3VtIHRvIG9uZVxucm93bmFtZXMoZnJlcV90YWJsZSlbNV0gPC0gXCI0K1wiXG5jb2xuYW1lcyhmcmVxX3RhYmxlKSA8LSBjKFwiRW1waXJpY2FsXCIsIFwiRml0dGVkXCIpXG5yb3VuZChmcmVxX3RhYmxlLCBkaWdpdHMgPSA2KSIsInNjdCI6Ik5tc2cgPC0gXCJEaWQgeW91IGNvcnJlY3RseSBzcGVjaWZ5IHRoZSBvYmplY3QgYE5gP1wiXG5leCgpICU+JSBjaGVja19vYmplY3QoXCJOXCIsIHVuZGVmaW5lZF9tc2cgPSBcIk1ha2Ugc3VyZSB0byBub3QgcmVtb3ZlIGBOYCFcIikgJT4lIGNoZWNrX2VxdWFsKGluY29ycmVjdF9tc2c9Tm1zZylcbmluaXRmcmVxbXNnIDwtIFwiRGlkIHlvdSBjb3JyZWN0bHkgc3BlY2lmeSB0aGUgb2JqZWN0IGBpbml0LnBhcm0uZnJlcWA/XCJcbmV4KCkgJT4lIGNoZWNrX29iamVjdChcImluaXQucGFybS5mcmVxXCIsIHVuZGVmaW5lZF9tc2cgPSBcIk1ha2Ugc3VyZSB0byBub3QgcmVtb3ZlIGBpbml0LnBhcm0uZnJlcWAhXCIpICU+JSBjaGVja19lcXVhbChpbmNvcnJlY3RfbXNnPWluaXRmcmVxbXNnKVxuZnJlcV9tb2Rtc2cgPC0gXCJEaWQgeW91IGNvcnJlY3RseSBzcGVjaWZ5IHRoZSBvYmplY3QgYGZyZXFfbW9kYD9cIlxuZXgoKSAlPiUgY2hlY2tfb2JqZWN0KFwiZnJlcV9tb2RcIiwgdW5kZWZpbmVkX21zZyA9IFwiTWFrZSBzdXJlIHRvIG5vdCByZW1vdmUgYGZyZXFfbW9kYCFcIikgJT4lIGNoZWNrX2VxdWFsKGluY29ycmVjdF9tc2c9ZnJlcV9tb2Rtc2cpXG5mcmVxX3RhYmxlbXNnIDwtIFwiRGlkIHlvdSBjb3JyZWN0bHkgc3BlY2lmeSB0aGUgb2JqZWN0IGBmcmVxX3RhYmxlYD9cIlxuZXgoKSAlPiUgY2hlY2tfb2JqZWN0KFwiZnJlcV90YWJsZVwiLCB1bmRlZmluZWRfbXNnID0gXCJNYWtlIHN1cmUgdG8gbm90IHJlbW92ZSBgZnJlcV90YWJsZWAhXCIpICU+JSBjaGVja19lcXVhbChpbmNvcnJlY3RfbXNnPWZyZXFfdGFibGVtc2cpXG5zdWNjZXNzX21zZyhcIkNoZWVycyEgVGhpcyBleGVyY2lzZSBwcm92aWRlcyBhIHF1aWNrIG92ZXJ2aWV3IG9mIHRoZSBpbXBvcnRhbnQgc3RlcHMgbmVlZGVkIGZvciBmcmVxdWVuY3kgbW9kZWxpbmcuIEluIGFjdHVhcmlhbCBwcmFjdGljZSwgaXQgaXMgY29tbW9uIHRvIGFkZCBjb3ZhcmlhdGVzIChyYXRpbmcgZmFjdG9ycykgZm9yIHJpc2sgY2xhc3NpZmljYXRpb24gcHVycG9zZXMuXCIpIiwiaGludCI6IlNpbmNlIDxlbT5vcHRpbTwvZW0+IG1pbmltaXplcyBnaXZlbiBmdW5jdGlvbiBieSBkZWZhdWx0LCB3ZSBwdXQgdGhlIG5lZ2F0aXZlIGxpa2VsaWhvb2QgYXMgYW4gb2JqZWN0aXZlIGZ1bmN0aW9uIHRvIGJlIG1pbmltaXplZC4ifQ==
</div>
</div>
<div id="exercise.-estimating-the-severity-component-of-the-collective-risk-model" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Exercise. Estimating the Severity Component of the Collective Risk Model</h3>
<p><strong>Assignment Text</strong></p>
<p>This is a continuation of Exercise <a href="aggregate-loss-models.html#Ex:FreqCollectRM">5.3.1</a>. In this assignment, we fit a <em>Pareto</em> distribution to the severity component. You may wish to review Exercise <a href="modeling-loss-severity.html#Ex:MLEPareto">3.5.1</a> where we fit a Pareto distribution to a different subset of the <strong>LGPIF</strong> data.</p>
<div class="blackbox">
<p><strong>Instructions</strong></p>
<ul>
<li>Restrict the sample to the subset of towns and identify the average claim severity as a global variable <span class="math inline">\(Xbar\)</span>.</li>
<li>Construct a function to determine the negative log-likelihood. Do this based on the probability density function <a href="https://www.rdocumentation.org/packages/bayesmeta/versions/2.6/topics/dlomax">dlomax()</a>. Note that we use the same parametrization as in the <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-Severity.html#S:ContinuousDistn">Section 3.2 of <em>Loss Data Analytics</em></a> so that <span class="math inline">\(\text{shape}=\alpha\)</span> and <span class="math inline">\(\text{scale}=\theta\)</span>.</li>
<li>Determine initial, or starting, values for the algorithm using the method of moments.</li>
<li>Use the function <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/optim">optim()</a> to find the maximum likelihood estimates of the severity distribution.</li>
<li>Provide a <span class="math inline">\(qq\)</span> plots of the empirical versus fitted quantiles to assess the adequacy of the model fit.</li>
</ul>
</div>
<p><br></p>
<div data-datacamp-exercise="" data-height="300" data-encoded="true">
eyJsYW5ndWFnZSI6InIiLCJwcmVfZXhlcmNpc2VfY29kZSI6Ikluc2FtcGxlIDwtIHJlYWQuY3N2KFwiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL09wZW5BY3RUZXh0cy9MREFDb3Vyc2UxL21haW4vRGF0YS9JbnNhbXBsZS5jc3ZcIiwgaGVhZGVyPVQsIG5hLnN0cmluZ3M9YyhcIi5cIiksIHN0cmluZ3NBc0ZhY3RvcnM9RkFMU0UpXG5saWJyYXJ5KGxtZTQpXG5cbmRsb21heCA8LSBmdW5jdGlvbih4LCBzaGFwZT0xLCBzY2FsZT0xLCBsb2c9RkFMU0UpIHtcbiAgaWYgKGxvZz09RkFMU0UpIHJlc3VsdCA8LSBzaGFwZSpzY2FsZV5zaGFwZSAvIChzY2FsZSArIHgpXihzaGFwZSsxKVxuICBpZiAobG9nPT1UUlVFICkgcmVzdWx0IDwtIGxvZyhzaGFwZSkrc2hhcGUqbG9nKHNjYWxlKS0oc2hhcGUrMSkqbG9nKHNjYWxlICsgeClcbiAgcmV0dXJuKHJlc3VsdCkgfSIsInNhbXBsZSI6Ikluc2FtcGxlVG93biA8LSBzdWJzZXQoSW5zYW1wbGUsIFR5cGVUb3duPT0xKVxuWGJhciA8LSBJbnNhbXBsZVRvd24keUF2Z1t3aGljaChJbnNhbXBsZVRvd24kRnJlcT4wKV1cbiMgVGhlIG5lZ2F0aXZlIExvZyAtIGxpa2VsaWhvb2RcbnNldl9saWsgPC0gZnVuY3Rpb24ocGFybSkge1xuICBhbHBoYSA8LSAgcGFybVsxXVxuICB0aGV0YSA8LSAgcGFybVsyXVxuICBsaWsgICA8LSAtc3VtKGRsb21heChYYmFyLCBzaGFwZT0/Pywgc2NhbGU9Pz8sIGxvZz1UUlVFKSlcbiAgcmV0dXJuKGxpaylcbn1cbiMgaW5pdGlhbCBlc3RpbWF0ZXMgYnkgbWV0aG9kIG9mIG1vbWVudHNcbmluaXQucGFybS5zZXYgPC0gYyggMi8oMS1tZWFuKFhiYXIpXjIvdmFyKFhiYXIpKSAgLCBtZWFuKFhiYXIpKigyLygxLW1lYW4oWGJhcileMi92YXIoWGJhcikpLTEpICkgXG4jIE1heGltdW0gbGlrZWxpaG9vZCBlc3RpbWF0aW9uIGZvciB0aGUgc2V2ZXJpdHkgbW9kZWxcbnNldl9tb2QgICAgPC0gPz8ocGFyPT8/LCBmbj1zZXZfbGlrLCBtZXRob2Q9XCJMLUJGR1MtQlwiKSBcbmFscGhhLmVzdCAgPC0gc2V2X21vZCRwYXJbMV1cbnRoZXRhLmVzdCAgPC0gc2V2X21vZCRwYXJbMl1cbiMgRW1waXJpY2FsIGFuZCBmaXR0ZWQgZGlzdHJpYnV0aW9ucyBvZiBvYnNlcnZlZCBYYmFyXG5wbG90KDEtKHRoZXRhLmVzdC8odGhldGEuZXN0K3NvcnQoWGJhcikpKV5hbHBoYS5lc3QsIHJhbmsoc29ydChYYmFyKSkvKGxlbmd0aChYYmFyKSsxKSxcbiAgICAgeWxhYiA9IFwiRW1waXJpY2FsIFF1YW50aWxlc1wiLCB4bGFiID0gXCJGaXR0ZWQgUXVhbnRpbGVzXCIsXG4gICAgIG1haW4gPSBcIlNldmVyaXR5IE1vZGVsIFFRIFBsb3RcIikiLCJzb2x1dGlvbiI6Ikluc2FtcGxlVG93biA8LSBzdWJzZXQoSW5zYW1wbGUsIFR5cGVUb3duPT0xKVxuWGJhciA8LSBJbnNhbXBsZVRvd24keUF2Z1t3aGljaChJbnNhbXBsZVRvd24kRnJlcT4wKV1cbiMgVGhlIG5lZ2F0aXZlIExvZyAtIGxpa2VsaWhvb2RcbnNldl9saWsgPC0gZnVuY3Rpb24ocGFybSkge1xuICBhbHBoYSA8LSAgcGFybVsxXVxuICB0aGV0YSA8LSAgcGFybVsyXVxuICBsaWsgICA8LSAtc3VtKGRsb21heChYYmFyLCBzaGFwZT1hbHBoYSwgc2NhbGU9dGhldGEsIGxvZz1UUlVFKSlcbiAgcmV0dXJuKGxpaylcbn1cbiMgaW5pdGlhbCBlc3RpbWF0ZXMgYnkgbWV0aG9kIG9mIG1vbWVudHNcbmluaXQucGFybS5zZXYgPC0gYyggMi8oMS1tZWFuKFhiYXIpXjIvdmFyKFhiYXIpKSAgLCBtZWFuKFhiYXIpKigyLygxLW1lYW4oWGJhcileMi92YXIoWGJhcikpLTEpICkgXG4jIE1heGltdW0gbGlrZWxpaG9vZCBlc3RpbWF0aW9uIGZvciB0aGUgc2V2ZXJpdHkgbW9kZWxcbnNldl9tb2QgICAgICAgPC0gb3B0aW0ocGFyPWluaXQucGFybS5zZXYsIGZuPXNldl9saWssIG1ldGhvZD1cIkwtQkZHUy1CXCIpIFxuYWxwaGEuZXN0ICAgICA8LSBzZXZfbW9kJHBhclsxXVxudGhldGEuZXN0ICAgICA8LSBzZXZfbW9kJHBhclsyXVxuIyBFbXBpcmljYWwgYW5kIGZpdHRlZCBkaXN0cmlidXRpb25zIG9mIG9ic2VydmVkIFhiYXJcbnBsb3QoMS0odGhldGEuZXN0Lyh0aGV0YS5lc3Qrc29ydChYYmFyKSkpXmFscGhhLmVzdCwgcmFuayhzb3J0KFhiYXIpKS8obGVuZ3RoKFhiYXIpKzEpLFxuICAgICB5bGFiID0gXCJFbXBpcmljYWwgUXVhbnRpbGVzXCIsIHhsYWIgPSBcIkZpdHRlZCBRdWFudGlsZXNcIixcbiAgICAgbWFpbiA9IFwiU2V2ZXJpdHkgTW9kZWwgUVEgUGxvdFwiKSIsInNjdCI6IlhiYXJtc2cgPC0gXCJEaWQgeW91IGNvcnJlY3RseSBzcGVjaWZ5IHRoZSBvYmplY3QgYFhiYXJgP1wiXG5leCgpICU+JSBjaGVja19vYmplY3QoXCJYYmFyXCIsIHVuZGVmaW5lZF9tc2cgPSBcIk1ha2Ugc3VyZSB0byBub3QgcmVtb3ZlIGBYYmFyYCFcIikgJT4lIGNoZWNrX2VxdWFsKGluY29ycmVjdF9tc2c9WGJhcm1zZylcbmluaXRzZXZtc2cgPC0gXCJEaWQgeW91IGNvcnJlY3RseSBzcGVjaWZ5IHRoZSBvYmplY3QgYGluaXQucGFybS5zZXZgP1wiXG5leCgpICU+JSBjaGVja19vYmplY3QoXCJpbml0LnBhcm0uc2V2XCIsIHVuZGVmaW5lZF9tc2cgPSBcIk1ha2Ugc3VyZSB0byBub3QgcmVtb3ZlIGBpbml0LnBhcm0uc2V2YCFcIikgJT4lIGNoZWNrX2VxdWFsKGluY29ycmVjdF9tc2c9aW5pdHNldm1zZylcbnNldl9tb2Rtc2cgPC0gXCJEaWQgeW91IGNvcnJlY3RseSBzcGVjaWZ5IHRoZSBvYmplY3QgYHNldl9tb2RgP1wiXG5leCgpICU+JSBjaGVja19vYmplY3QoXCJzZXZfbW9kXCIsIHVuZGVmaW5lZF9tc2cgPSBcIk1ha2Ugc3VyZSB0byBub3QgcmVtb3ZlIGBzZXZfbW9kYCFcIikgJT4lIGNoZWNrX2VxdWFsKGluY29ycmVjdF9tc2c9c2V2X21vZG1zZylcbnN1Y2Nlc3NfbXNnKFwiQ2hlZXJzISBUaGlzIGV4ZXJjaXNlIHByb3ZpZGVzIGEgcXVpY2sgb3ZlcnZpZXcgb2YgdGhlIGltcG9ydGFudCBzdGVwcyBuZWVkZWQgZm9yIHNldmVyaXR5IG1vZGVsaW5nLiBOb3RlIHRoYXQgaXQgaXMgdXN1YWwgdG8gb2JzZXJ2ZSB0aGF0IGFuIGFjdHVhbCBjbGFpbXMgZGF0YXNldCBtYXkgY29tZSB3aXRoIHZlcnkgZmV3IHBvc2l0aXZlIGNsYWltcyBidXQgYWxzbyBoZWF2eSB0YWlsIGJlaGF2aW9yLlwiKSIsImhpbnQiOiJTaW5jZSA8ZW0+b3B0aW08L2VtPiBtaW5pbWl6ZXMgZ2l2ZW4gZnVuY3Rpb24gYnkgZGVmYXVsdCwgd2UgcHV0IHRoZSBuZWdhdGl2ZSBsaWtlbGlob29kIGFzIGFuIG9iamVjdGl2ZSBmdW5jdGlvbiB0byBiZSBtaW5pbWl6ZWQuIn0=
</div>
</div>
</div>
<div id="computation-strategies-for-a-collective-risk-model" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Computation Strategies for a Collective Risk Model</h2>
<hr />
<p>In this section, we learn how to:</p>
<ul>
<li>Compute the aggregate loss distribution.</li>
<li>Implement numerical strategies in <code>R</code>.</li>
</ul>
<hr />
<div id="video-computing-a-collective-risk-model-distribution" class="section level4 unnumbered">
<h4>Video: Computing a Collective Risk Model Distribution</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_37zojz7d&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_v2a227tt" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-computing-a-collective-risk-model-distribution-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Computing a Collective Risk Model Distribution (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect532A')">A. Computing the Aggregate Loss Distribution</button>
<button class="tablinks" onclick="openTab(event, 'Sect532B')">B. Direct Calculation</button>
<button class="tablinks" onclick="openTab(event, 'Sect532C')">C. Direct Calculation - R Code</button>
<button class="tablinks" onclick="openTab(event, 'Sect532D')">D. Recursive Method</button>
<button class="tablinks" onclick="openTab(event, 'Sect532E')">E. Recursive Method - R Code</button>
<button class="tablinks" onclick="openTab(event, 'Sect532F')">F. Monte Carlo Simulation</button>
</div>
<div id="Sect532A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=29" width="100%" height="400"> </iframe>
</div>
<div id="Sect532B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=30" width="100%" height="400"> </iframe>
</div>
<div id="Sect532C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=32" width="100%" height="400"> </iframe>
</div>
<div id="Sect532D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=34" width="100%" height="400"> </iframe>
</div>
<div id="Sect532E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=36" width="100%" height="400"> </iframe>
</div>
<div id="Sect532F" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=37" width="100%" height="400"> </iframe>
</div>
<p>xx
### Exercise. Collective Risk Model II
<img src = "ContributorPics/hurdler.png" width = "65" height = "65" style = "float:right; margin-left: 10px; margin-top: 7px" /></p>
<p><strong>Assignment Text</strong></p>
<p>In this assignment, we analyze the aggregate loss distribution by combining fitted frequency and severity components. Because it is usually very hard to obtain a closed form expression for the distribution function of the compound loss in a collective risk model, we rely on simulations to compute the aggregate loss distribution. We use the fitted parameters from the exercises in Section <a href="aggregate-loss-models.html#Sec:CollRisk1">5.3</a>. Specifically, fitted shape and scale negative binomial parameters have already been recorded as the global variables <code>r.est</code> and <code>beta.est</code>, respectively. In the same way, fitted shape and scale Pareto parameters have already been recorded as the global variables <code>alpha.est</code> and <code>theta.est</code>, respectively.</p>
<div class="blackbox">
<p><strong>Instructions</strong></p>
<ul>
<li>As an input to calculating the aggregate distribution, we need the <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/expression">expression</a> function. This function allows to call functions without actually evaluating them.</li>
<li>Also, to generate random samples from the fitted frequency and severity models, we use <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/NegBinomial">rnbinom()</a> and <a href="https://www.rdocumentation.org/packages/bayesmeta/versions/2.6/topics/dlomax">rlomax()</a>. Note that these generated random samples are also used as inputs to compute the aggregate claim amount distribution.</li>
<li>We use <a href="https://www.rdocumentation.org/packages/actuar/versions/3.1-1/topics/aggregateDist">aggregateDist()</a> to simulate compound losses that match the observed data upon the fitted frequency and severity models.</li>
<li>With the aggregate distribution, plot its distribution function. For comparison, superimpose on this plot the empiricial (cumulative) distribution function, created using the <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/ecdf">ecdf()</a> function.</li>
</ul>
</div>
<p><br></p>
<div data-datacamp-exercise="" data-height="300" data-encoded="true">
eyJsYW5ndWFnZSI6InIiLCJwcmVfZXhlcmNpc2VfY29kZSI6Ikluc2FtcGxlIDwtIHJlYWQuY3N2KFwiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL09wZW5BY3RUZXh0cy9MREFDb3Vyc2UxL21haW4vRGF0YS9JbnNhbXBsZS5jc3ZcIiwgaGVhZGVyPVQsIG5hLnN0cmluZ3M9YyhcIi5cIiksIHN0cmluZ3NBc0ZhY3RvcnM9RkFMU0UpXG5saWJyYXJ5KGxtZTQpXG5cbmFnZ3JlZ2F0ZS5wb3J0Zm9saW8gPC0gZnVuY3Rpb24oeCwgYnkgPSBuYW1lcyh4JG5vZGVzKSwgRlVOID0gc3VtLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc2lmaWNhdGlvbiA9IFRSVUUsIHByZWZpeCA9IE5VTEwsIC4uLilcbntcbiAgICBsZXZlbC5uYW1lcyA8LSBuYW1lcyh4JG5vZGVzKSAgICAgICAjIGxldmVsIG5hbWVzXG4gICAgbmxldmVscyA8LSBsZW5ndGgobGV2ZWwubmFtZXMpICAgICAgIyBudW1iZXIgb2YgbGV2ZWxzXG4gICAgeWVhcnMgPC0gbGV2ZWwubmFtZXNbbmxldmVsc10gICAgICAgIyBuYW1lIG9mIGxhc3QgbGV2ZWxcblxuICAgICMjIE1hdGNoIGxldmVsIG5hbWVzIGluICdieScgdG8gdGhvc2UgaW4gdGhlIG1vZGVsXG4gICAgYnkgPC0gbWF0Y2guYXJnKGJ5LCBsZXZlbC5uYW1lcywgc2V2ZXJhbC5vayA9IFRSVUUpXG5cbiAgICAjIyBWZXJzaW9uIG9mIEZVTiBhYmxlIHRvIHdvcmsgb24gbGlzdHNcbiAgICBmdW4gPC0gZnVuY3Rpb24oeCwgLi4uKSBGVU4odW5saXN0KHgpLCAuLi4pXG5cbiAgICAjIyBUaGUgbW9zdCBjb21tb24gY2FzZSBzaG91bGQgYmUgdG8gYWdncmVnYXRlIGNsYWltIGFtb3VudHMgYnlcbiAgICAjIyBub2RlLiBUaGlzIGNhc2UgYmVpbmcgdmVyeSBzaW1wbGUsIGl0IGlzIHRyZWF0ZWQgc2VwYXJhdGVseS5cbiAgICBpZiAoaWRlbnRpY2FsKGJ5LCBsZXZlbC5uYW1lcykpXG4gICAgICAgIHJldHVybihjYmluZChpZiAoY2xhc3NpZmljYXRpb24pIHgkY2xhc3NpZmljYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICBhcnJheShzYXBwbHkoeCRkYXRhLCBGVU4sIC4uLiksIGRpbSh4JGRhdGEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgZGltbmFtZXMgPSBsaXN0KE5VTEwsIHBhc3RlKHByZWZpeCwgY29sbmFtZXMoeCRkYXRhKSwgc2VwID0gXCJcIikpKSkpXG5cbiAgICAjIyBTdW1tYXJpZXMgb25seSBieSBsYXN0IGxldmVsICh5ZWFycykgYXJlIGFsc28gc2ltcGxlIHRvIGhhbmRsZS5cbiAgICBpZiAoaWRlbnRpY2FsKGJ5LCB5ZWFycykpXG4gICAge1xuICAgICAgICByZXMgPC0gYXBwbHkoeCRkYXRhLCAyLCBmdW4sIC4uLilcbiAgICAgICAgbmFtZXMocmVzKSA8LSBwYXN0ZShwcmVmaXgsIGNvbG5hbWVzKHgkZGF0YSksIHNlcCA9IFwiXCIpXG4gICAgICAgIHJldHVybihyZXMpXG4gICAgfVxuXG4gICAgIyMgVGhlIG90aGVyIHBvc3NpYmlsaXRpZXMgcmVxdWlyZSB0byBzcGxpdCB0aGUgZGF0YSBpbiBncm91cHMgYXNcbiAgICAjIyBzcGVjaWZpZWQgaW4gYXJndW1lbnQgJ2J5Jy4gSWYgdGhlIGxhc3QgbGV2ZWwgKHllYXJzKSBpcyBpblxuICAgICMjICdieScsIHRoZW4gdGhlIG1hdHJpeCBzdHJ1Y3R1cmUgbXVzdCBiZSByZXRhaW5lZCB0byBtYWtlIHRoZVxuICAgICMjIHN1bW1hcmllcy4gT3RoZXJ3aXNlLCBpdCBjYW4ganVzdCBiZSBkcm9wcGVkIHNpbmNlIHN1bW1hcmllc1xuICAgICMjIHdpbGwgc3BhbiB0aGUgeWVhcnMgb2Ygb2JzZXJ2YXRpb24uXG4gICAgIyNcbiAgICAjIyBDb252ZXJ0IHRoZSBzZXF1ZW5jZSBvZiBzdWJzY3JpcHRzIGludG8gZmFjdG9ycyBieSBwYXN0aW5nIHRoZVxuICAgICMjIGRpZ2l0cyB0b2dldGhlci4gSXQgaXMgaW1wb3J0YW50ICpub3QqIHRvIHNvcnQgdGhlIGxldmVscyBpblxuICAgICMjIGNhc2UgdGhlIGxldmVscyBpbiAnYnknIGFyZSBub3QgaW4gdGhlIHNhbWUgb3JkZXIgYXMgaW5cbiAgICAjIyAnbGV2ZWwubmFtZXMnLlxuICAgIHJvd3MgPC0gc2V0ZGlmZihieSwgeWVhcnMpICAgICAgICAgICMgZ3JvdXBzIG90aGVyIHRoYW4geWVhcnNcbiAgICBzIDwtIHgkY2xhc3NpZmljYXRpb25bLCByb3dzLCBkcm9wID0gRkFMU0VdICMgc3Vic2NyaXB0c1xuICAgIGYgPC0gYXBwbHkocywgMSwgcGFzdGUsIGNvbGxhcHNlID0gXCJcIikgICAgICAjIGdyb3VwaW5nIElEc1xuICAgIGYgPC0gZmFjdG9yKGYsIGxldmVscyA9IHVuaXF1ZShmKSkgICAgICAgICAgIyBmYWN0b3JzXG4gICAgcyA8LSBzW21hdGNoKGxldmVscyhmKSwgZiksICwgZHJvcCA9IEZBTFNFXSAjIHVuaXF1ZSBzdWJzY3JpcHRzXG4gICAgeHggPC0gc3BsaXQoeCRkYXRhLCBmKSAgICAgICAgICAgICAgICAgICAgICAjIHNwbGl0IGRhdGFcblxuICAgICMjIE1ha2Ugc3VtbWFyaWVzXG4gICAgaWYgKHllYXJzICVpbiUgYnkpXG4gICAge1xuICAgICAgICB4eCA8LSBsYXBwbHkoeHgsIG1hdHJpeCwgbmNvbCA9IG5jb2woeCRkYXRhKSlcbiAgICAgICAgcmVzIDwtIHQoc2FwcGx5KHh4LCBmdW5jdGlvbih4LCAuLi4pIGFwcGx5KHgsIDIsIGZ1biwgLi4uKSwgLi4uKSlcbiAgICAgICAgY29scyA8LSBjb2xuYW1lcyh4JGRhdGEpXG4gICAgfVxuICAgIGVsc2VcbiAgICB7XG4gICAgICAgIHJlcyA8LSBzYXBwbHkoeHgsIGZ1biwgLi4uKVxuICAgICAgICBjb2xzIDwtIGRlcGFyc2Uoc3Vic3RpdHV0ZShGVU4pKVxuICAgIH1cblxuICAgICMjIFJldHVybiByZXN1bHRzIGFzIGEgbWF0cml4XG4gICAgc3RydWN0dXJlKGNiaW5kKGlmIChjbGFzc2lmaWNhdGlvbikgcywgcmVzKSxcbiAgICAgICAgICAgICAgZGltbmFtZXMgPSBsaXN0KE5VTEwsIGMoaWYgKGNsYXNzaWZpY2F0aW9uKSByb3dzLCBwYXN0ZShwcmVmaXgsIGNvbHMsIHNlcCA9IFwiXCIpKSkpXG59XG5cbnNpbVMgPC0gZnVuY3Rpb24obiwgbW9kZWwuZnJlcSwgbW9kZWwuc2V2KVxue1xuICBcbiAgICBuPTEwMDBcbiAgICBtb2RlbC5mcmVxID0gZnJlcVxuICAgIG1vZGVsLnNldiA9IHNldlxuICAgIFxuICAgICMjIFByZXBhcmUgdGhlIGNhbGwgdG8gc2ltdWwoKSBieSBidWlsZGluZyB1cCAnbm9kZXMnXG4gICAgbGV2ZWwubmFtZXMgPC0gbmFtZXMoaWYgKGlzLm51bGwobW9kZWwuZnJlcSkpIG1vZGVsLnNldiBlbHNlIG1vZGVsLmZyZXEpXG4gICAgbmxldmVscyA8LSBsZW5ndGgobGV2ZWwubmFtZXMpXG4gICAgbm9kZXMgPC0gYXMubGlzdChjKHJlcCgxLCBubGV2ZWxzIC0gMSksIG4pKVxuICAgIG5hbWVzKG5vZGVzKSA8LSBsZXZlbC5uYW1lc1xuXG4gICAgIyMgR2V0IHNhbXBsZVxuICAgIHggPC0gYWdncmVnYXRlKHNpbXVsKG5vZGVzID0gbm9kZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuZnJlcSA9IG1vZGVsLmZyZXEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuc2V2ID0gbW9kZWwuc2V2KSlbLTFdXG5cbiAgICAjIyBDb21wdXRlIHRoZSBlbXBpcmljYWwgY2RmIG9mIHRoZSBzYW1wbGUuIERvbmUgbWFudWFsbHkgaW5zdGVhZFxuICAgICMjIG9mIGNhbGxpbmcgc3RhdHM6OjplY2RmKCkgdG8ga2VlcCBhIGNvcHkgb2YgdGhlIGVtcGlyaWNhbCBwbWZcbiAgICAjIyBpbiB0aGUgZW52aXJvbm1lbnQgd2l0aG91dCBjb21wdXRpbmcgaXQgdHdpY2UuXG4gICAgeCA8LSBzb3J0KHgpXG4gICAgdmFscyA8LSB1bmlxdWUoeClcbiAgICBmcyA8LSB0YWJ1bGF0ZShtYXRjaCh4LCB2YWxzKSkvbGVuZ3RoKHgpXG4gICAgRlVOIDwtIGFwcHJveGZ1bih2YWxzLCBwbWluKGN1bXN1bShmcyksIDEpLCBtZXRob2QgPSBcImNvbnN0YW50XCIsXG4gICAgICAgICAgICAgICAgICAgICB5bGVmdCA9IDAsIHlyaWdodCA9IDEsIGYgPSAwLCB0aWVzID0gXCJvcmRlcmVkXCIpXG4gICAgY2xhc3MoRlVOKSA8LSBjKFwiZWNkZlwiLCBcInN0ZXBmdW5cIiwgY2xhc3MoRlVOKSlcbiAgICBhc3NpZ24oXCJmc1wiLCBmcywgZW52aXIgPSBlbnZpcm9ubWVudChGVU4pKVxuICAgIEZVTlxufVxuXG5hZ2dyZWdhdGVEaXN0IDwtXG4gICAgZnVuY3Rpb24obWV0aG9kID0gYyhcInJlY3Vyc2l2ZVwiLCBcImNvbnZvbHV0aW9uXCIsIFwibm9ybWFsXCIsIFwibnBvd2VyXCIsIFwic2ltdWxhdGlvblwiKSxcbiAgICAgICAgICAgICBtb2RlbC5mcmVxID0gTlVMTCwgbW9kZWwuc2V2ID0gTlVMTCwgcDAgPSBOVUxMLCB4LnNjYWxlID0gMSxcbiAgICAgICAgICAgICBjb252b2x2ZSA9IDAsIG1vbWVudHMsIG5iLnNpbXVsLCAuLi4sXG4gICAgICAgICAgICAgdG9sID0gMWUtMDYsIG1heGl0ID0gNTAwLCBlY2hvID0gRkFMU0UpXG57XG4gICAgQ2FsbCA8LSBtYXRjaC5jYWxsKClcblxuICAgICMjIFRoZSBtZXRob2QgdXNlZCBlc3NlbnRpYWxseSB0ZWxscyB3aGljaCBmdW5jdGlvbiBzaG91bGQgYmVcbiAgICAjIyBjYWxsZWQgZm9yIHRoZSBjYWxjdWxhdGlvbiBvZiB0aGUgYWdncmVnYXRlIGNsYWltc1xuICAgICMjIGRpc3RyaWJ1dGlvbi5cbiAgICBtZXRob2QgPC0gbWF0Y2guYXJnKG1ldGhvZClcblxuICAgIGlmIChtZXRob2QgPT0gXCJub3JtYWxcIilcbiAgICB7XG4gICAgICAgICMjIEFuIGVycm9yIG1lc3NhZ2UgaXMgaXNzdWVkIGlmIHRoZSBudW1iZXIgb2YgbW9tZW50cyBsaXN0ZWRcbiAgICAgICAgIyMgaXMgbm90IGFwcHJvcHJpYXRlIGZvciB0aGUgbWV0aG9kLiBIb3dldmVyIGl0IGlzIHRoZSB1c2VyJ3NcbiAgICAgICAgIyMgcmVzcG9uc2liaWxpdHkgdG8gbGlzdCB0aGUgbW9tZW50cyBpbiB0aGUgY29ycmVjdCBvcmRlclxuICAgICAgICAjIyBzaW5jZSB0aGUgdmVjdG9yIGlzIG5vdCByZXF1aXJlZCB0byBiZSBuYW1lZC5cbiAgICAgICAgaWYgKG1pc3NpbmcobW9tZW50cykgfHwgbGVuZ3RoKG1vbWVudHMpIDwgMilcbiAgICAgICAgICAgIHN0b3AoXCInbW9tZW50cycgbXVzdCBzdXBwbHkgdGhlIG1lYW4gYW5kIHZhcmlhbmNlIG9mIHRoZSBkaXN0cmlidXRpb25cIilcbiAgICAgICAgRlVOIDwtIG5vcm1hbChtb21lbnRzWzFdLCBtb21lbnRzWzJdKVxuICAgICAgICBjb21tZW50KEZVTikgPC0gXCJOb3JtYWwgYXBwcm94aW1hdGlvblwiXG4gICAgfVxuXG4gICAgZWxzZSBpZiAobWV0aG9kID09IFwibnBvd2VyXCIpXG4gICAge1xuICAgICAgICBpZiAobWlzc2luZyhtb21lbnRzKSB8fCBsZW5ndGgobW9tZW50cykgPCAzKVxuICAgICAgICAgICAgc3RvcChcIidtb21lbnRzJyBtdXN0IHN1cHBseSB0aGUgbWVhbiwgdmFyaWFuY2UgYW5kIHNrZXduZXNzIG9mIHRoZSBkaXN0cmlidXRpb25cIilcbiAgICAgICAgRlVOIDwtIG5wb3dlcihtb21lbnRzWzFdLCBtb21lbnRzWzJdLCBtb21lbnRzWzNdKVxuICAgICAgICBjb21tZW50KEZVTikgPC0gXCJOb3JtYWwgUG93ZXIgYXBwcm94aW1hdGlvblwiXG4gICAgfVxuICAgIGVsc2UgaWYgKG1ldGhvZCA9PSBcInNpbXVsYXRpb25cIilcbiAgICB7XG4gICAgICAgIGlmIChtaXNzaW5nKG5iLnNpbXVsKSlcbiAgICAgICAgICAgIHN0b3AoXCInbmIuc2ltdWwnIG11c3Qgc3VwcGx5IHRoZSBudW1iZXIgb2Ygc2ltdWxhdGlvbnNcIilcbiAgICAgICAgaWYgKGlzLm51bGwobmFtZXMobW9kZWwuZnJlcSkpICYmIGlzLm51bGwobmFtZXMobW9kZWwuc2V2KSkpXG4gICAgICAgICAgICBzdG9wKFwiZXhwcmVzc2lvbnMgaW4gJ21vZGVsLmZyZXEnIGFuZCAnbW9kZWwuc2V2JyBtdXN0IGJlIG5hbWVkXCIpXG4gICAgICAgIEZVTiA8LSBzaW1TKG5iLnNpbXVsLCBtb2RlbC5mcmVxID0gbW9kZWwuZnJlcSwgbW9kZWwuc2V2ID0gbW9kZWwuc2V2KVxuICAgICAgICBjb21tZW50KEZVTikgPC0gXCJBcHByb3hpbWF0aW9uIGJ5IHNpbXVsYXRpb25cIlxuICAgIH1cbiAgICBlbHNlXG4gICAge1xuICAgICAgICAjIyBcInJlY3Vyc2l2ZVwiIGFuZCBcImNvbnZvbHV0aW9uXCIgY2FzZXMuIEJvdGggcmVxdWlyZSBhXG4gICAgICAgICMjIGRpc2NyZXRlIGRpc3RyaWJ1dGlvbiBvZiBjbGFpbSBhbW91bnRzLCB0aGF0IGlzIGEgdmVjdG9yIG9mXG4gICAgICAgICMjIHByb2JhYmlsaXRpZXMgaW4gYXJndW1lbnQgJ21vZGVsLnNldicuXG4gICAgICAgIGlmICghaXMubnVtZXJpYyhtb2RlbC5zZXYpKVxuICAgICAgICAgICAgc3RvcChcIidtb2RlbC5zZXYnIG11c3QgYmUgYSB2ZWN0b3Igb2YgcHJvYmFiaWxpdGllc1wiKVxuXG4gICAgICAgICMjIFJlY3Vyc2l2ZSBtZXRob2QgdXNlcyBhIG1vZGVsIGZvciB0aGUgZnJlcXVlbmN5IGRpc3RyaWJ1dGlvbi5cbiAgICAgICAgaWYgKG1ldGhvZCA9PSBcInJlY3Vyc2l2ZVwiKVxuICAgICAgICB7XG4gICAgICAgICAgICBpZiAoaXMubnVsbChtb2RlbC5mcmVxKSB8fCAhaXMuY2hhcmFjdGVyKG1vZGVsLmZyZXEpKVxuICAgICAgICAgICAgICAgIHN0b3AoXCJmcmVxdWVuY3kgZGlzdHJpYnV0aW9uIG11c3QgYmUgc3VwcGxpZWQgYXMgYSBjaGFyYWN0ZXIgc3RyaW5nXCIpXG4gICAgICAgICAgICBkaXN0IDwtIG1hdGNoLmFyZyh0b2xvd2VyKG1vZGVsLmZyZXEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyhcInBvaXNzb25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJnZW9tZXRyaWNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuZWdhdGl2ZSBiaW5vbWlhbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJpbm9taWFsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibG9nYXJpdGhtaWNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ6ZXJvLXRydW5jYXRlZCBwb2lzc29uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiemVyby10cnVuY2F0ZWQgZ2VvbWV0cmljXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiemVyby10cnVuY2F0ZWQgbmVnYXRpdmUgYmlub21pYWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ6ZXJvLXRydW5jYXRlZCBiaW5vbWlhbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInplcm8tbW9kaWZpZWQgbG9nYXJpdGhtaWNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ6ZXJvLW1vZGlmaWVkIHBvaXNzb25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ6ZXJvLW1vZGlmaWVkIGdlb21ldHJpY1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInplcm8tbW9kaWZpZWQgbmVnYXRpdmUgYmlub21pYWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ6ZXJvLW1vZGlmaWVkIGJpbm9taWFsXCIpKVxuICAgICAgICAgICAgRlVOIDwtIHBhbmplcihmeCA9IG1vZGVsLnNldiwgZGlzdCA9IGRpc3QsIHAwID0gcDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHguc2NhbGUgPSB4LnNjYWxlLCAuLi4sIGNvbnZvbHZlID0gY29udm9sdmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRvbCA9IHRvbCwgbWF4aXQgPSBtYXhpdCwgZWNobyA9IGVjaG8pXG4gICAgICAgICAgICBjb21tZW50KEZVTikgPC0gXCJSZWN1cnNpdmUgbWV0aG9kIGFwcHJveGltYXRpb25cIlxuICAgICAgICB9XG5cbiAgICAgICAgIyMgQ29udm9sdXRpb24gbWV0aG9kIHJlcXVpcmVzIGEgdmVjdG9yIG9mIHByb2JhYmlsaXRpZXMgaW5cbiAgICAgICAgIyMgYXJndW1lbnQgJ21vZGVsLmZyZXEnLlxuICAgICAgICBlbHNlIGlmIChtZXRob2QgPT0gXCJjb252b2x1dGlvblwiKVxuICAgICAgICB7XG4gICAgICAgICAgICBpZiAoIWlzLm51bWVyaWMobW9kZWwuZnJlcSkpXG4gICAgICAgICAgICAgICAgc3RvcChcIidtb2RlbC5mcmVxJyBtdXN0IGJlIGEgdmVjdG9yIG9mIHByb2JhYmlsaXRpZXNcIilcbiAgICAgICAgICAgIEZVTiA8LSBleGFjdChmeCA9IG1vZGVsLnNldiwgcG4gPSBtb2RlbC5mcmVxLCB4LnNjYWxlID0geC5zY2FsZSlcbiAgICAgICAgICAgIGNvbW1lbnQoRlVOKSA8LSBcIkV4YWN0IGNhbGN1bGF0aW9uIChjb252b2x1dGlvbnMpXCJcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBzdG9wKFwiaW50ZXJuYWwgZXJyb3JcIilcbiAgICB9XG5cbiAgICAjIyBSZXR1cm4gY3VtdWxhdGl2ZSBkaXN0cmlidXRpb24gZnVuY3Rpb25cbiAgICBjbGFzcyhGVU4pIDwtIGMoXCJhZ2dyZWdhdGVEaXN0XCIsIGNsYXNzKEZVTikpXG4gICAgYXR0cihGVU4sIFwiY2FsbFwiKSA8LSBDYWxsXG4gICAgRlVOXG4gICAgfVxuXG5cbnBsb3QuYWdncmVnYXRlRGlzdCA8LSBmdW5jdGlvbih4LCB4bGltLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlsYWIgPSBleHByZXNzaW9uKEZbU10oeCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4gPSBcIkFnZ3JlZ2F0ZSBDbGFpbSBBbW91bnQgRGlzdHJpYnV0aW9uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViID0gY29tbWVudCh4KSwgLi4uKVxue1xuICAgICMjIEZ1bmN0aW9uIHBsb3QoKSBpcyB1c2VkIGZvciB0aGUgc3RlcCBjZGZzIGFuZCBmdW5jdGlvbiBjdXJ2ZSgpXG4gICAgIyMgaW4gdGhlIGNvbnRpbnVvdXMgY2FzZXMuXG4gICAgaWYgKFwic3RlcGZ1blwiICVpbiUgY2xhc3MoeCkpXG4gICAge1xuICAgICAgICAjIyBNZXRob2QgZm9yIGNsYXNzICdlY2RmJyB3aWxsIG1vc3QgcHJvYmFibHkgYmUgdXNlZC5cbiAgICAgICAgTmV4dE1ldGhvZChtYWluID0gbWFpbiwgeWxhYiA9IHlsYWIsIC4uLilcbiAgICB9XG4gICAgZWxzZVxuICAgIHtcbiAgICAgICAgIyMgTGltaXRzIGZvciB0aGUgeC1heGlzIGFyZSBzdXBwbGllZCBpZiBub25lIGFyZSBnaXZlblxuICAgICAgICAjIyBpbiBhcmd1bWVudC5cbiAgICAgICAgaWYgKG1pc3NpbmcoeGxpbSkpXG4gICAgICAgIHtcbiAgICAgICAgICAgIG1lYW4gPC0gZ2V0KFwibWVhblwiLCBlbnZpciA9IGVudmlyb25tZW50KHgpKVxuICAgICAgICAgICAgc2QgPC0gc3FydChnZXQoXCJ2YXJpYW5jZVwiLCBlbnZpciA9IGVudmlyb25tZW50KHgpKSlcbiAgICAgICAgICAgIHhsaW0gPC0gYyhtZWFuIC0gMyAqIHNkLCBtZWFuICsgMyAqIHNkKVxuICAgICAgICB9XG4gICAgICAgIGN1cnZlKHgsIG1haW4gPSBtYWluLCB5bGFiID0geWxhYiwgeGxpbSA9IHhsaW0sIHlsaW0gPSBjKDAsIDEpLCAuLi4pXG4gICAgfVxuICAgIG10ZXh0KHN1YiwgbGluZSA9IDAuNSlcbn1cblxuc2ltdWwgPC0gZnVuY3Rpb24obm9kZXMsIG1vZGVsLmZyZXEgPSBOVUxMLCBtb2RlbC5zZXYgPSBOVUxMLCB3ZWlnaHRzID0gTlVMTClcbntcbiAgICAjIyBHZXQgbGV2ZWwgbmFtZXMuIEVhY2ggY291bGQgYmUgTlVMTC5cbiAgICBsZXZlbC5uYW1lcyA8LSBuYW1lcyhub2RlcylcbiAgICBmcmVxLm5hbWVzIDwtIG5hbWVzKG1vZGVsLmZyZXEpXG4gICAgc2V2Lm5hbWVzIDwtIG5hbWVzKG1vZGVsLnNldilcblxuICAgICMjICdub2RlcycgbXVzdCBiZSBhIG5hbWVkIGxpc3QuIE9uZSBleGNlcHRpb24gaXMgYWxsb3dlZDogdGhlcmVcbiAgICAjIyBpcyBvbmx5IG9uZSBsZXZlbC4gSW4gdGhpcyBjYXNlLCBhZGQgYSBwcmVkZXRlcm1pbmVkIG5hbWUgaWZcbiAgICAjIyB0aGVyZSBpc24ndCBvbmUgYWxyZWFkeSBhbmQgbWFrZSBzdXJlICdub2RlcycgaXMgYSBsaXN0LlxuICAgIGlmIChsZW5ndGgobm9kZXMpID09IDFMKVxuICAgIHtcbiAgICAgICAgaWYgKGlzLm51bGwobGV2ZWwubmFtZXMpKVxuICAgICAgICAgICAgbmFtZXMobm9kZXMpIDwtIFwiWFwiXG4gICAgICAgIG5vZGVzIDwtIGFzLmxpc3Qobm9kZXMpXG4gICAgfVxuICAgIGVsc2VcbiAgICB7XG4gICAgICAgIGlmICghaXMubGlzdChub2RlcykgfHwgaXMubnVsbChsZXZlbC5uYW1lcykpXG4gICAgICAgICAgICBzdG9wKFwiJ25vZGVzJyBtdXN0IGJlIGEgbmFtZWQgbGlzdFwiKVxuICAgIH1cblxuICAgICMjIERldGVybWluZSBpZiBmcmVxdWVuY3kgYW5kIHNldmVyaXR5IG1vZGVscyBhcmUgcHJlc2VudC4gS2VlcFxuICAgICMjIGZvciBmdXR1cmUgdXNlLlxuICAgIGhhcy5mcmVxIDwtICFhbGwoc2FwcGx5KG1vZGVsLmZyZXEsIGlzLm51bGwpKVxuICAgIGhhcy5zZXYgIDwtICFhbGwoc2FwcGx5KG1vZGVsLnNldiwgaXMubnVsbCkpXG5cbiAgICAjIyBDaGVjayB0aGF0IGF0IGxlYXN0IG9uZSBvZiAnbW9kZWwuZnJlcScgb3IgJ21vZGVsLnNldicgaXNcbiAgICAjIyBwcmVzZW50IGFuZCB0aGF0IHRoZSBsZXZlbCBuYW1lcyBtYXRjaCB3aXRoIHRob3NlIG9mICdub2RlcycuXG4gICAgIyMgUGVyaGFwcyBpcyB0aGVyZSBhIGZhbmNpZXIgd2F5IHRvIGRvIGFsbCB0aGVzZSB0ZXN0cywgYnV0IHRoZVxuICAgICMjIHZlcnNpb24gYmVsb3cgaXMgYXQgbGVhc3QgZWFzeSB0byBmb2xsb3cuXG4gICAgaWYgKGhhcy5mcmVxKVxuICAgIHtcbiAgICAgICAgaWYgKGhhcy5zZXYpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICghIChpZGVudGljYWwobGV2ZWwubmFtZXMsIGZyZXEubmFtZXMpICYmXG4gICAgICAgICAgICAgICAgICAgaWRlbnRpY2FsKGxldmVsLm5hbWVzLCBzZXYubmFtZXMpKSlcbiAgICAgICAgICAgICAgICBzdG9wKFwibGV2ZWwgbmFtZXMgZGlmZmVyZW50IGluICdub2RlcycsICdtb2RlbC5mcmVxJyBhbmQgJ21vZGVsLnNldidcIilcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICghaWRlbnRpY2FsKGxldmVsLm5hbWVzLCBmcmVxLm5hbWVzKSlcbiAgICAgICAgICAgICAgICBzdG9wKFwibGV2ZWwgbmFtZXMgZGlmZmVyZW50IGluICdub2RlcycsICdtb2RlbC5mcmVxJyBhbmQgJ21vZGVsLnNldidcIilcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlXG4gICAge1xuICAgICAgICBpZiAoaGFzLnNldilcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKCFpZGVudGljYWwobGV2ZWwubmFtZXMsIHNldi5uYW1lcykpXG4gICAgICAgICAgICAgICAgc3RvcChcImxldmVsIG5hbWVzIGRpZmZlcmVudCBpbiAnbm9kZXMnLCAnbW9kZWwuZnJlcScgYW5kICdtb2RlbC5zZXYnXCIpXG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgc3RvcChcIm9uZSBvZiAnbW9kZWwuZnJlcScgb3IgJ21vZGVsLnNldicgbXVzdCBiZSBub24tTlVMTFwiKVxuICAgIH1cblxuICAgICMjIFRoZSBmdW5jdGlvbiBpcyB3cml0dGVuIGZvciBtb2RlbHMgd2l0aCBhdCBsZWFzdCB0d28gbGV2ZWxzXG4gICAgIyMgKGVudGl0eSBhbmQgeWVhcikuIElmIHRoZXJlIGlzIG9ubHkgb25lLCBhZGQgYSBkdW1teSBsZXZlbCB0b1xuICAgICMjIGF2b2lkIHNjYXR0ZXJpbmcgdGhlIGNvZGUgd2l0aCBjb25kaXRpb25zLlxuICAgIGlmIChsZW5ndGgobm9kZXMpIDwgMkwpXG4gICAge1xuICAgICAgICBub2RlcyA8LSBjKG5vZGUgPSAxLCBub2RlcylcbiAgICAgICAgbW9kZWwuZnJlcSA8LVxuICAgICAgICAgICAgaWYgKGhhcy5mcmVxKSBjKGV4cHJlc3Npb24obm9kZSA9IE5VTEwpLCBtb2RlbC5mcmVxKSBlbHNlIE5VTExcbiAgICAgICAgbW9kZWwuc2V2IDwtXG4gICAgICAgICAgICBpZiAoaGFzLnNldikgYyhleHByZXNzaW9uKG5vZGUgPSBOVUxMKSwgbW9kZWwuc2V2KSBlbHNlIE5VTExcbiAgICB9XG5cbiAgICAjIyBGcmVxdWVudGx5IHVzZWQgcXVhbnRpdGllc1xuICAgIGxldmVsLm5hbWVzIDwtIG5hbWVzKG5vZGVzKSAgICAgICAgICMgbmVlZCB0byByZXNldCFcbiAgICBubGV2ZWxzIDwtIGxlbmd0aChub2RlcykgICAgICAgICAgICAjIG51bWJlciBvZiBsZXZlbHNcblxuICAgICMjIFJlY3ljbGluZyBvZiB0aGUgbnVtYmVyIG9mIG5vZGVzIChpZiBuZWVkZWQpIG11c3QgYmUgZG9uZVxuICAgICMjIFwibWFudWFsbHlcIi4gV2UgZG8gaXQgaGVyZSBvbmNlIGFuZCBmb3IgYWxsIHNpbmNlIGluIGFueSBjYXNlXG4gICAgIyMgYmVsb3cgd2Ugd2lsbCBuZWVkIHRvIGtub3cgdGhlIHRvdGFsIG51bWJlciBvZiBub2RlcyBpbiB0aGVcbiAgICAjIyBwb3J0Zm9saW8uIEZ1cnRoZXJtb3JlLCB0aGUgcmVjeWNsZWQgbGlzdCAnbm9kZXMnIHdpbGwgYmVcbiAgICAjIyByZXR1cm5lZCBieSB0aGUgZnVuY3Rpb24uXG4gICAgZm9yIChpIGluIDJMOm5sZXZlbHMpICAgICAgICMgZmlyc3Qgbm9kZSBkb2Vzbid0IG5lZWQgcmVjeWNsaW5nXG4gICAgICAgIG5vZGVzW1tpXV0gPC0gcmVwKG5vZGVzW1tpXV0sIGxlbmd0aCA9IHN1bShub2Rlc1tbaSAtIDFMXV0pKVxuXG4gICAgIyMgU2ltdWxhdGlvbiBvZiB0aGUgZnJlcXVlbmN5IG1peGluZyBwYXJhbWV0ZXJzIGZvciBlYWNoIGxldmVsXG4gICAgIyMgKGUuZy4gY2xhc3MsIGNvbnRyYWN0KSBhbmQsIGF0IHRoZSBsYXN0IGxldmVsLCB0aGUgYWN0dWFsXG4gICAgIyMgZnJlcXVlbmNpZXMuIElmICdtb2RlbC5mcmVxJyBpcyBOVUxMLCB0aGlzIGlzIGVxdWl2YWxlbnQgdG9cbiAgICAjIyBoYXZpbmcgb25lIGNsYWltIHBlciBub2RlLlxuICAgIGlmIChoYXMuZnJlcSlcbiAgICB7XG4gICAgICAgICMjIE5vcm1hbGx5LCBvbmx5IHRoZSBpbW1lZGlhdGVseSBhYm92ZSBtaXhpbmcgcGFyYW1ldGVyIHdpbGxcbiAgICAgICAgIyMgYmUgdXNlZCBpbiB0aGUgbW9kZWwgZm9yIGEgbGV2ZWwsIGJ1dCB0aGUgY29kZSBoZXJlIGFsbG93c1xuICAgICAgICAjIyBmb3IgbW9yZSBnZW5lcmFsIHNjaGVtZXMuIEZvciB0aGlzIHRvIHdvcmssIGFsbCBtaXhpbmdcbiAgICAgICAgIyMgcGFyYW1ldGVycyBoYXZlIHRvIGJlIGNvcnJlY3RseSByZWN5Y2xlZCBhdCBlYWNoIGxldmVsXG4gICAgICAgICMjIHdoZXJlIHRoZXkgKmNvdWxkKiBiZSB1c2VkLiBTaW5jZSB0aGUgbW9kZWwgYXQgYW55IGxldmVsXG4gICAgICAgICMjIGNvdWxkIGJlIE5VTEwsICdwYXJhbXMnIHdpbGwga2VlcCB0cmFjayBvZiB0aGUgbWl4aW5nXG4gICAgICAgICMjIHBhcmFtZXRlcnMgdGhhdCB3ZXJlIHNpbXVsYXRlZCBpbiBwcmV2aW91cyBpdGVyYXRpb24gb2YgdGhlXG4gICAgICAgICMjIGZvcnRoY29taW5nIGxvb3AuXG4gICAgICAgIHBhcmFtcyA8LSBjaGFyYWN0ZXIoMClcblxuICAgICAgICBmb3IgKGkgaW4gc2VxX2xlbihubGV2ZWxzKSlcbiAgICAgICAge1xuICAgICAgICAgICAgIyMgTnVtYmVyIG9mIG5vZGVzIGF0IHRoZSBjdXJyZW50IGxldmVsXG4gICAgICAgICAgICBuLmN1cnJlbnQgPC0gbm9kZXNbW2ldXVxuXG4gICAgICAgICAgICAjIyBFeHRyYWN0IHNpbXVsYXRpb24gbW9kZWwgZm9yIHRoZSBsZXZlbC5cbiAgICAgICAgICAgIENhbGwgPC0gbW9kZWwuZnJlcVtbaV1dXG5cbiAgICAgICAgICAgICMjIFJlcGVhdCB0aGUgbWl4aW5nIHBhcmFtZXRlcnMgb2YgYWxsIGxldmVscyBhYm92ZSB0aGVcbiAgICAgICAgICAgICMjIGN1cnJlbnQgb25lIHRoYXQgd2VyZSBzaW11bGF0ZWQgaW4gdGhlIHBhc3QuXG4gICAgICAgICAgICBmb3IgKGogaW4gc2VxX2Fsb25nKHBhcmFtcykpXG4gICAgICAgICAgICAgICAgZXZhbChzdWJzdGl0dXRlKHggPC0gcmVwLmludCh4LCBuLmN1cnJlbnQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0KHggPSBhcy5uYW1lKHBhcmFtc1tbal1dKSkpKVxuXG4gICAgICAgICAgICAjIyBTaW11bGF0ZSBkYXRhIG9ubHkgaWYgdGhlcmUgaXMgYSBtb2RlbCBhdCB0aGUgY3VycmVudFxuICAgICAgICAgICAgIyMgbGV2ZWwuXG4gICAgICAgICAgICBpZiAoIWlzLm51bGwoQ2FsbCkpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgIyMgQWRkIHRoZSBudW1iZXIgb2YgdmFyaWF0ZXMgdG8gdGhlIGNhbGwuXG4gICAgICAgICAgICAgICAgQ2FsbCRuIDwtIHN1bShuLmN1cnJlbnQpXG5cbiAgICAgICAgICAgICAgICAjIyBTaW11bGF0aW9uIG9mIHRoZSBtaXhpbmcgcGFyYW1ldGVycyBvciB0aGUgZGF0YS4gSW5cbiAgICAgICAgICAgICAgICAjIyB0aGUgbGF0dGVyIGNhc2UsIHN0b3JlIHRoZSByZXN1bHRzIGluIGEgZml4ZWRcbiAgICAgICAgICAgICAgICAjIyB2YXJpYWJsZSBuYW1lLlxuICAgICAgICAgICAgICAgIGlmIChpIDwgbmxldmVscylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2lnbihsZXZlbC5uYW1lc1tbaV1dLCBldmFsKENhbGwpKVxuICAgICAgICAgICAgICAgICAgICBwYXJhbXNbaV0gPC0gbGV2ZWwubmFtZXNbW2ldXSAjIHJlbWVtYmVyIHRoZSBwYXJhbWV0ZXJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBmcmVxdWVuY2llcyA8LSBldmFsKENhbGwpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZVxuICAgICAgICBmcmVxdWVuY2llcyA8LSByZXAuaW50KDEsIHN1bShub2Rlc1tbbmxldmVsc11dKSlcblxuICAgICMjIFNpbXVsYXRpb24gb2YgdGhlIGNsYWltIGFtb3VudHMuIElmICdtb2RlbC5zZXYnIGlzIE5VTEwsIHRoaXNcbiAgICAjIyBpcyBlcXVpdmFsZW50IHRvIHNpbXVsYXRpbmcgZnJlcXVlbmNpZXMgb25seS5cbiAgICBpZiAoaGFzLnNldilcbiAgICB7XG4gICAgICAgICMjIFJlcGVhdCB0aGUgc2FtZSBwcm9jZWR1cmUgYXMgZm9yIHRoZSBmcmVxdWVuY3kgbW9kZWwsIHdpdGhcbiAgICAgICAgIyMgb25lIGRpZmZlcmVuY2U6IHdoZW4gcmVhY2hpbmcgdGhlIGxhc3QgbGV2ZWwgKGNsYWltXG4gICAgICAgICMjIGFtb3VudHMpLCB0aGUgbnVtYmVyIG9mIHZhcmlhdGVzIHRvIHNpbXVsYXRlIGlzIG5vdCBnaXZlblxuICAgICAgICAjIyBieSB0aGUgbnVtYmVyIG9mIG5vZGVzIGJ1dCByYXRoZXIgYnkgdGhlIG51bWJlciBvZiBjbGFpbXNcbiAgICAgICAgIyMgYXMgZm91bmQgaW4gJ2ZyZXF1ZW5jaWVzJy5cbiAgICAgICAgcGFyYW1zIDwtIGNoYXJhY3RlcigwKVxuXG4gICAgICAgIGZvciAoaSBpbiBzZXFfbGVuKG5sZXZlbHMpKVxuICAgICAgICB7XG4gICAgICAgICAgICBuLmN1cnJlbnQgPC0gbm9kZXNbW2ldXVxuICAgICAgICAgICAgQ2FsbCA8LSBtb2RlbC5zZXZbW2ldXVxuXG4gICAgICAgICAgICBmb3IgKGogaW4gc2VxX2Fsb25nKHBhcmFtcykpXG4gICAgICAgICAgICAgICAgZXZhbChzdWJzdGl0dXRlKHggPC0gcmVwLmludCh4LCBuLmN1cnJlbnQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0KHggPSBhcy5uYW1lKHBhcmFtc1tbal1dKSkpKVxuXG4gICAgICAgICAgICBpZiAoIWlzLm51bGwoQ2FsbCkpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgIyMgVGhlIHJlc3Qgb2YgdGhlIHByb2NlZHVyZSBkaWZmZXJzIGRlcGVuZGluZyBpZiB3ZVxuICAgICAgICAgICAgICAgICMjIGFyZSBzdGlsbCBzaW11bGF0aW5nIG1peGluZyBwYXJhbWV0ZXJzIG9yIGNsYWltXG4gICAgICAgICAgICAgICAgIyMgYW1vdW50cy5cbiAgICAgICAgICAgICAgICBpZiAoaSA8IG5sZXZlbHMpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAjIyBTaW11bGF0aW9uIG9mIG1peGluZyBwYXJhbWV0ZXJzIGlzIGlkZW50aWNhbCB0byB0aGVcbiAgICAgICAgICAgICAgICAgICAgIyMgc2ltdWxhdGlvbiBvZiBmcmVxdWVuY2llcy5cbiAgICAgICAgICAgICAgICAgICAgQ2FsbCRuIDwtIHN1bShuLmN1cnJlbnQpXG4gICAgICAgICAgICAgICAgICAgIGFzc2lnbihsZXZlbC5uYW1lc1tbaV1dLCBldmFsKENhbGwpKVxuICAgICAgICAgICAgICAgICAgICBwYXJhbXNbaV0gPC0gbGV2ZWwubmFtZXNbW2ldXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAjIyBGb3IgdGhlIHNpbXVsYXRpb24gb2YgY2xhaW0gYW1vdW50cywgdGhlIG51bWJlclxuICAgICAgICAgICAgICAgICAgICAjIyBvZiB2YXJpYXRlcyBpcyByYXRoZXIgZ2l2ZW4gYnkgdGhlXG4gICAgICAgICAgICAgICAgICAgICMjICdmcmVxdWVuY2llcycgb2JqZWN0LiBGdXJ0aGVybW9yZSwgdGhlIG1peGluZ1xuICAgICAgICAgICAgICAgICAgICAjIyBwYXJhbWV0ZXJzIG11c3QgYmUgcmVjeWNsZWQgb25jZSBtb3JlIHRvIG1hdGNoXG4gICAgICAgICAgICAgICAgICAgICMjIHRoZSB2ZWN0b3Igb2YgZnJlcXVlbmNpZXMuXG4gICAgICAgICAgICAgICAgICAgIGZvciAocCBpbiBpbnRlcnNlY3QoYWxsLnZhcnMoQ2FsbCksIHBhcmFtcykpXG4gICAgICAgICAgICAgICAgICAgICAgICBldmFsKHN1YnN0aXR1dGUoeCA8LSByZXAuaW50KHgsIGZyZXF1ZW5jaWVzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0KHggPSBhcy5uYW1lKHApKSkpXG4gICAgICAgICAgICAgICAgICAgIENhbGwkbiA8LSBzdW0oZnJlcXVlbmNpZXMpXG4gICAgICAgICAgICAgICAgICAgIHNldmVyaXRpZXMgPC1ldmFsKENhbGwpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2VcbiAgICAgICAgc2V2ZXJpdGllcyA8LSByZXAuaW50KDEsIHN1bShmcmVxdWVuY2llcykpXG5cbiAgICAjIyBXZSBtdXN0IG5vdyBkaXN0cmlidXRlIHRoZSBjbGFpbSBhbW91bnRzIGluIHZlY3RvciAnc2V2ZXJpdGllcydcbiAgICAjIyB0byB0aGUgYXBwcm9wcmlhdGUgbm9kZXMuIFRoaXMgaXMgY29tcGxpY2F0ZWQgYnkgdGhlXG4gICAgIyMgcG9zc2liaWxpdHkgdG8gaGF2ZSBkaWZmZXJlbnQgbnVtYmVyIG9mIG5vZGVzICh5ZWFycyBvZlxuICAgICMjIG9ic2VydmF0aW9uKSBmb3IgZWFjaCBlbnRpdHkuIFRoZSByZXN1bHQgbXVzdCBiZSBhIG1hdHJpeFxuICAgICMjIHdpdGggdGhlIG51bWJlciBvZiBjb2x1bW5zIGVxdWFsIHRvIHRoZSBtYXhpbXVtIG51bWJlciBvZiBsYXN0XG4gICAgIyMgbGV2ZWwgbm9kZXMuXG4gICAgIyNcbiAgICAjIyBUaGUgbnVtYmVyIG9mIG5vZGVzICh5ZWFycyBvZiBvYnNlcnZhdGlvbikgcGVyIGVudGl0eSBpc1xuICAgICMjIGdpdmVuIGJ5ICduLmN1cnJlbnQnIHNpbmNlIHdlIHJlYWNoZWQgdGhlIGxhc3QgbGV2ZWwgaW4gKGVpdGhlclxuICAgICMjIG9uZSBvZikgdGhlIGFib3ZlIGxvb3BzLlxuICAgICMjXG4gICAgIyMgQXNzaWduIGEgdW5pcXVlIElEIHRvIGVhY2ggbm9kZSwgbGVhdmluZyBnYXBzIGZvciBub2RlcyB3aXRob3V0XG4gICAgIyMgb2JzZXJ2YXRpb25zLlxuICAgIGluZCA8LSB1bmxpc3QobWFwcGx5KHNlcSxcbiAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tID0gc2VxKGJ5ID0gbWF4KG4uY3VycmVudCksIGFsb25nID0gbi5jdXJyZW50KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBuLmN1cnJlbnQpKVxuXG4gICAgIyMgUmVwZWF0aW5nIHRoZSB2ZWN0b3Igb2YgSURzIGFjY29yZGluZyB0byB0aGUgZnJlcXVlbmNpZXNcbiAgICAjIyBlZmZlY3RpdmVseSBhc3NpZ25zIGEgbm9kZSBJRCB0byBlYWNoIGNsYWltIGFtb3VudC4gVGhlIHZlY3RvclxuICAgICMjIG9mIGNsYWltIGFtb3VudHMgaXMgdGhlbiBzcGxpdCBieSBub2RlLCB5aWVsZGluZyBhIGxpc3Qgd2hlcmVcbiAgICAjIyBlYWNoIGVsZW1lbnQgY29ycmVzcG9uZHMgdG8gYSBub2RlIHdpdGggY2xhaW1zLlxuICAgIGYgPC0gcmVwLmludChpbmQsIGZyZXF1ZW5jaWVzKVxuICAgIHNldmVyaXRpZXMgPC0gc3BsaXQoc2V2ZXJpdGllcywgZilcblxuICAgICMjIElkZW50aWZ5IG5vZGVzIHdpdGggZnJlcXVlbmN5IGVxdWFsIHRvIDAsIHdoaWNoIGlzIGRpZmZlcmVudFxuICAgICMjIGZyb20gaGF2aW5nIG5vIG9ic2VydmF0aW9uIChOQSkuXG4gICAgZnJlcTAgPC0gaW5kW3doaWNoKGZyZXF1ZW5jaWVzID09IDApXVxuXG4gICAgIyMgUmVhcnJhbmdlIHRoZSBsaXN0IG9mIGNsYWltIGFtb3VudHMgaW4gYSBtYXRyaXg7XG4gICAgIyNcbiAgICAjIyAgICAgIG51bWJlciBvZiByb3dzOiBudW1iZXIgb2Ygbm9kZXMgYXQgdGhlIHBlbnVsdGltYXRlIGxldmVsXG4gICAgIyMgICAgICAgICAgICAgICAgICAgICAgKG51bWJlciBvZiBlbnRpdGllcylcbiAgICAjIyAgIG51bWJlciBvZiBjb2x1bW5zOiBtYXhpbXVtIG51bWJlciBvZiBub2RlcyBhdCB0aGUgbGFzdCBsZXZlbFxuICAgICMjICAgICAgICAgICAgICAgICAgICAgIChudW1iZXIgb2YgeWVhcnMgb2Ygb2JzZXJ2YXRpb24pLlxuICAgICMjXG4gICAgIyMgTW9yZW92ZXIsIGFzc2lnbiBhIHZhbHVlIG9mICdudW1lcmljKDApJyB0byBub2RlcyB3aXRoIGFcbiAgICAjIyBmcmVxdWVuY3kgb2YgMC5cbiAgICBucm93IDwtIGxlbmd0aChuLmN1cnJlbnQpICAgICAgICAgICAjIG51bWJlciBvZiBlbnRpdGllc1xuICAgIG5jb2wgPC0gbWF4KG4uY3VycmVudCkgICAgICAgICAgICAgICMgbnVtYmVyIG9mIHllYXJzXG4gICAgcmVzIDwtIGFzLmxpc3QocmVwLmludChOQSwgbnJvdyAqIG5jb2wpKVxuICAgIHJlc1t1bmlxdWUoZildIDwtIHNldmVyaXRpZXNcbiAgICByZXNbZnJlcTBdIDwtIGxhcHBseShyZXAuaW50KDAsIGxlbmd0aChmcmVxMCkpLCBudW1lcmljKVxuICAgIHJlcyA8LSBtYXRyaXgocmVzLCBucm93LCBuY29sLCBieXJvdyA9IFRSVUUsXG4gICAgICAgICAgICAgICAgICBkaW1uYW1lcyA9IGxpc3QoTlVMTCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZShsZXZlbC5uYW1lc1tubGV2ZWxzXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXFfbGVuKG5jb2wpLCBzZXAgPSBcIi5cIikpKVxuXG4gICAgIyMgUmVzaGFwZSB3ZWlnaHRzIGFzIGEgbWF0cml4LCBpZiBuZWNlc3NhcnkuXG4gICAgd2VpZ2h0cyA8LSBpZiAoaXMubnVsbCh3ZWlnaHRzKSlcbiAgICAgICAgTlVMTFxuICAgIGVsc2VcbiAgICB7XG4gICAgICAgICMjIEludGVncmF0ZSBOQXMgaW50byB0aGUgd2VpZ2h0cyBtYXRyaXggYXMgYXBwcm9wcmlhdGUuXG4gICAgICAgIHcgPC0gcmVwLmludChOQSwgbnJvdyAqIG5jb2wpXG4gICAgICAgIHdbaW5kXSA8LSB3ZWlnaHRzXG4gICAgICAgIG1hdHJpeCh3LCBucm93ID0gbnJvdywgYnlyb3cgPSBUUlVFLCBkaW1uYW1lcyA9IGRpbW5hbWVzKHJlcykpXG4gICAgfVxuXG4gICAgIyMgRmluYWxseSwgY3JlYXRlIGEgbWF0cml4IHdoZXJlIGVhY2ggcm93IGNvbnRhaW5zIHRoZSBzZXJpZXMgb2ZcbiAgICAjIyBpZGVudGlmaWVycyBmb3IgYW4gZW50aXR5IGluIHRoZSBwb3J0Zm9saW8sIGUuZy4gaWYgdGhlIGRhdGFcbiAgICAjIyBpcyBkZW5vdGVkIFhfe2lqa3R9LCBvbmUgbGluZSBvZiB0aGUgbWF0cml4IHdpbGwgY29udGFpblxuICAgICMjIHN1YnNjcmlwdHMgaSwgaiBhbmQgay4gQXMgd2UgbW92ZSBmcm9tIHJpZ2h0IHRvIGxlZnQgaW4gdGhlXG4gICAgIyMgY29sdW1ucyBvZiAnbScsIHRoZSBzdWJzY3JpcHRzIGFyZSBpbmNyZWFzaW5nbHkgcmVwZWF0ZWQuXG4gICAgbmNvbCA8LSBubGV2ZWxzIC0gMUxcbiAgICBtIDwtIG1hdHJpeCgxLCBucm93LCBuY29sLFxuICAgICAgICAgICAgICAgIGRpbW5hbWVzID0gbGlzdChOVUxMLCBoZWFkKGxldmVsLm5hbWVzLCBuY29sKSkpXG4gICAgZm9yIChpIGluIHNlcV9sZW4obmNvbCAtIDFMKSkgICAgIyBhbGwgYnV0IHRoZSBsYXN0IGNvbHVtblxuICAgIHtcbiAgICAgICAgIyMgVmVjdG9yICd4JyB3aWxsIG9yaWdpbmFsbHkgY29udGFpbiBhbGwgc3Vic2NyaXB0cyBmb3Igb25lXG4gICAgICAgICMjIGxldmVsLiBUaGVzZSBzdWJzY3JpcHRzIGFyZSB0aGVuIHJlcGVhdGVkIGFzIG5lZWRlZCB0byBnaXZlXG4gICAgICAgICMjIHRoZSBkZXNpcmVkIHJlc3VsdC4gVG8gYXZvaWQgYW5vdGhlciBleHBsaWNpdCBsb29wLCBJIHVzZSBhXG4gICAgICAgICMjICdsYXBwbHknIHdpdGggYSBkaXJlY3QgYXNzaWdubWVudCBpbiB0aGUgY3VycmVudFxuICAgICAgICAjIyBmcmFtZS4gU29tZXdoYXQgdW51c3VhbCwgYnV0IHRoaXMgaXMgdGhlIHNpbXBsZXN0IHByb2NlZHVyZVxuICAgICAgICAjIyBJIG1hbmFnZWQgdG8gY29tZSB1cCB3aXRoLlxuICAgICAgICB4IDwtIHVubGlzdChsYXBwbHkobm9kZXNbW2ldXSwgc2VxKSlcbiAgICAgICAgbGFwcGx5KG5vZGVzWyhpICsgMUwpOihubGV2ZWxzIC0gMUwpXSxcbiAgICAgICAgICAgICAgIGZ1bmN0aW9uKHYpIGFzc2lnbihcInhcIiwgcmVwLmludCh4LCB2KSwgZW52aXIgPSBwYXJlbnQuZnJhbWUoMikpKVxuICAgICAgICBtWywgaV0gPC0geFxuICAgIH1cbiAgICBtWywgbmNvbF0gPC0gdW5saXN0KGxhcHBseShub2Rlc1tbbmNvbF1dLCBzZXEpKSAjIGxhc3QgY29sdW1uXG5cbiAgICAjIyBSZXR1cm4gb2JqZWN0IG9mIGNsYXNzICdwb3J0Zm9saW8nXG4gICAgc3RydWN0dXJlKGxpc3QoZGF0YSA9IHJlcyxcbiAgICAgICAgICAgICAgICAgICB3ZWlnaHRzID0gd2VpZ2h0cyxcbiAgICAgICAgICAgICAgICAgICBjbGFzc2lmaWNhdGlvbiA9IG0sXG4gICAgICAgICAgICAgICAgICAgbm9kZXMgPSBub2RlcyxcbiAgICAgICAgICAgICAgICAgICBtb2RlbC5mcmVxID0gbW9kZWwuZnJlcSxcbiAgICAgICAgICAgICAgICAgICBtb2RlbC5zZXYgPSBtb2RlbC5zZXYpLFxuICAgICAgICAgICAgICBjbGFzcyA9IFwicG9ydGZvbGlvXCIpXG59XG5cbmRsb21heCA8LSBmdW5jdGlvbih4LCBzaGFwZT0xLCBzY2FsZT0xLCBsb2c9RkFMU0UpIHtcbiAgaWYgKGxvZz09RkFMU0UpIHJlc3VsdCA8LSBzaGFwZSpzY2FsZV5zaGFwZSAvIChzY2FsZSArIHgpXihzaGFwZSsxKVxuICBpZiAobG9nPT1UUlVFICkgcmVzdWx0IDwtIGxvZyhzaGFwZSkrc2hhcGUqbG9nKHNjYWxlKS0oc2hhcGUrMSkqbG9nKHNjYWxlICsgeClcbiAgcmV0dXJuKHJlc3VsdCkgfVxuXG5ybG9tYXggPC0gZnVuY3Rpb24obiwgc2hhcGU9MSwgc2NhbGU9MSkge1xuICB1IDwtIHJ1bmlmKG4pXG4gIHJlc3VsdCA8LSBzY2FsZSooKDEgLSB1KV4oLTEvc2hhcGUpLTEpXG4gIHJldHVybihyZXN1bHQpIH1cblxuSW5zYW1wbGVUb3duIDwtIHN1YnNldChJbnNhbXBsZSwgVHlwZVRvd249PTEpXG5cbiMgVGhlIG5lZ2F0aXZlIGJpbm9taWFsIGZyZXF1ZW5jeSBtb2RlbDogTlxuTiA8LSBJbnNhbXBsZVRvd24kRnJlcVxuZnJlcV9saWsgPC0gZnVuY3Rpb24ocGFybSkge1xuICByICAgIDwtIHBhcm1bMV1cbiAgYmV0YSA8LSBwYXJtWzJdXG4gIGxpayAgPC0gLXN1bShkbmJpbm9tKE4sIHNpemU9ciwgcHJvYj0xLygxK2JldGEpLCBsb2c9VFJVRSkpXG4gIHJldHVybihsaWspXG59XG5pbml0LnBhcm0uZnJlcSA8LSBjKG1lYW4oTikvKHZhcihOKS9tZWFuKE4pLTEpLCB2YXIoTikvbWVhbihOKS0xKSAjIGluaXRpYWwgZXN0aW1hdGVzIGJ5IG1ldGhvZCBvZiBtb21lbnRzXG5mcmVxX21vZCAgICAgICA8LSBvcHRpbShwYXI9aW5pdC5wYXJtLmZyZXEsIGZuPWZyZXFfbGlrKSAjIE1heGltdW0gbGlrZWxpaG9vZCBlc3RpbWF0aW9uIGZvciB0aGUgZnJlcXVlbmN5IG1vZGVsXG5cbnIuZXN0ICAgIDwtIGZyZXFfbW9kJHBhclsxXVxuYmV0YS5lc3QgPC0gZnJlcV9tb2QkcGFyWzJdXG5cbiMgVGhlIFBhcmV0byBzZXZlcml0eSBtb2RlbDogWGJhclxuWGJhciA8LSBJbnNhbXBsZVRvd24keUF2Z1t3aGljaChJbnNhbXBsZVRvd24kRnJlcT4wKV1cbnNldl9saWsgPC0gZnVuY3Rpb24ocGFybSkge1xuICBhbHBoYSA8LSAgcGFybVsxXVxuICB0aGV0YSA8LSAgcGFybVsyXVxuICBsaWsgICA8LSAtc3VtKGRsb21heChYYmFyLCBzaGFwZT1hbHBoYSwgc2NhbGU9dGhldGEsIGxvZz1UUlVFKSlcbiAgcmV0dXJuKGxpaylcbn1cbmluaXQucGFybS5zZXYgPC0gYyggMi8oMS1tZWFuKFhiYXIpXjIvdmFyKFhiYXIpKSAgLCBtZWFuKFhiYXIpKigyLygxLW1lYW4oWGJhcileMi92YXIoWGJhcikpLTEpICkgIyBpbml0aWFsIGVzdGltYXRlcyBieSBtZXRob2Qgb2YgbW9tZW50c1xuc2V2X21vZCAgICAgICA8LSBvcHRpbShwYXI9aW5pdC5wYXJtLnNldiwgZm49c2V2X2xpaywgbWV0aG9kPVwiTC1CRkdTLUJcIikgIyBNYXhpbXVtIGxpa2VsaWhvb2QgZXN0aW1hdGlvbiBmb3IgdGhlIHNldmVyaXR5IG1vZGVsXG5hbHBoYS5lc3QgICAgIDwtIHNldl9tb2QkcGFyWzFdXG50aGV0YS5lc3QgICAgIDwtIHNldl9tb2QkcGFyWzJdIiwic2FtcGxlIjoiIyBQYXJhbWV0ZXIgZXN0aW1hdGVzIGZyb20gdGhlIGZyZXF1ZW5jeSBtb2RlbDogYWxwaGEuZXN0LCB0aGV0YS5lc3RcbiMgUGFyYW1ldGVyIGVzdGltYXRlcyBmcm9tIHRoZSBzZXZlcml0eSAgbW9kZWw6ICAgICByLmVzdCwgIGJldGEuZXN0XG5cbiMgUmFuZG9tIHNhbXBsZXMgZnJvbSBmaXR0ZWQgZnJlcXVlbmN5IGFuZCBzZXZlcml0eSBtb2RlbHNcbmZyZXEgPC0gZXhwcmVzc2lvbihkYXRhID0gID8/KHNpemU9Pz8sIHByb2I9MS8oMSs/PykpKVxuc2V2ICA8LSBleHByZXNzaW9uKGRhdGEgPSAgPz8oc2hhcGU9Pz8sIHNjYWxlPT8/KSlcbiMgVGhlIGFnZ3JlZ2F0ZSBkaXN0cmlidXRpb24gXG5GcyAgIDwtIGFnZ3JlZ2F0ZURpc3QoXCJzaW11bGF0aW9uXCIsIG5iLnNpbXVsID0gMTAwMCwgbW9kZWwuZnJlcSA9ID8/LCBtb2RlbC5zZXYgPSA/PylcbnBsb3QoRnMpXG5saW5lcyhlY2RmKEluc2FtcGxlVG93biR5KSwgIGNvbD1cImJsdWVcIilcbmxlZ2VuZChcImJvdHRvbXJpZ2h0XCIsIGxlZ2VuZCA9IGMoXCJTaW11bGF0aW9uXCIsIFwiRW1waXJpY2FsXCIpLCBjb2w9YyhcImJsYWNrXCIsXCJibHVlXCIpLCBsdHk9YygxLDIpLCBwY2g9YygxLCAxOSkpIiwic29sdXRpb24iOiIjIFBhcmFtZXRlciBlc3RpbWF0ZXMgZnJvbSB0aGUgZnJlcXVlbmN5IG1vZGVsOiBhbHBoYS5lc3QsIHRoZXRhLmVzdFxuIyBQYXJhbWV0ZXIgZXN0aW1hdGVzIGZyb20gdGhlIHNldmVyaXR5ICBtb2RlbDogICAgIHIuZXN0LCAgYmV0YS5lc3RcblxuIyBSYW5kb20gc2FtcGxlcyBmcm9tIGZpdHRlZCBmcmVxdWVuY3kgYW5kIHNldmVyaXR5IG1vZGVsc1xuZnJlcSA8LSBleHByZXNzaW9uKGRhdGEgPSAgcm5iaW5vbShzaXplPXIuZXN0LCBwcm9iPTEvKDErYmV0YS5lc3QpKSlcbnNldiAgPC0gZXhwcmVzc2lvbihkYXRhID0gIHJsb21heChzaGFwZT1hbHBoYS5lc3QsIHNjYWxlPXRoZXRhLmVzdCkpXG4jIFRoZSBhZ2dyZWdhdGUgZGlzdHJpYnV0aW9uIFxuRnMgICA8LSBhZ2dyZWdhdGVEaXN0KFwic2ltdWxhdGlvblwiLCBuYi5zaW11bCA9IDEwMDAsIG1vZGVsLmZyZXEgPSBmcmVxLCBtb2RlbC5zZXYgPSBzZXYpXG5wbG90KEZzKVxubGluZXMoZWNkZihJbnNhbXBsZVRvd24keSksICBjb2w9XCJibHVlXCIpXG5sZWdlbmQoXCJib3R0b21yaWdodFwiLCBsZWdlbmQgPSBjKFwiU2ltdWxhdGlvblwiLCBcIkVtcGlyaWNhbFwiKSwgY29sPWMoXCJibGFja1wiLFwiYmx1ZVwiKSwgbHR5PWMoMSwyKSwgcGNoPWMoMSwgMTkpKSIsInNjdCI6IkZzbXNnIDwtIFwiRGlkIHlvdSBjb3JyZWN0bHkgc3BlY2lmeSB0aGUgb2JqZWN0IGBGc2A/XCJcbmV4KCkgJT4lIGNoZWNrX29iamVjdChcIkZzXCIsIHVuZGVmaW5lZF9tc2cgPSBcIk1ha2Ugc3VyZSB0byBub3QgcmVtb3ZlIGBGc2AhXCIpICU+JSBjaGVja19lcXVhbChpbmNvcnJlY3RfbXNnPUZzbXNnKVxuZnJlcW1zZyA8LSBcIkRpZCB5b3UgY29ycmVjdGx5IHNwZWNpZnkgdGhlIG9iamVjdCBgZnJlcWA/XCJcbmV4KCkgJT4lIGNoZWNrX29iamVjdChcImZyZXFcIiwgdW5kZWZpbmVkX21zZyA9IFwiTWFrZSBzdXJlIHRvIG5vdCByZW1vdmUgYGZyZXFgIVwiKSAlPiUgY2hlY2tfZXF1YWwoaW5jb3JyZWN0X21zZz1mcmVxbXNnKVxuc2V2bXNnIDwtIFwiRGlkIHlvdSBjb3JyZWN0bHkgc3BlY2lmeSB0aGUgb2JqZWN0IGBzZXZgP1wiXG5leCgpICU+JSBjaGVja19vYmplY3QoXCJzZXZcIiwgdW5kZWZpbmVkX21zZyA9IFwiTWFrZSBzdXJlIHRvIG5vdCByZW1vdmUgYHNldmAhXCIpICU+JSBjaGVja19lcXVhbChpbmNvcnJlY3RfbXNnPXNldm1zZylcbnN1Y2Nlc3NfbXNnKFwiR29vZCBqb2IhIFRoaXMgZXhhbXBsZSBkZW1vbnN0cmF0ZXMgaG93IHRvIHVzZSBzaW11bGF0aW9uIHRvIGNhbGN1bGF0ZSBhIGNvbXBsaWNhdGVkIChkaXN0cmlidXRpb24pIGZ1bmN0aW9uLiBJdCBpcyBhbiBpbXBvcnRhbnQgdGFzayBpbiBvcmRlciB0byB2aXN1YWxpemUgdGhlIGRpc3RyaWJ1dGlvbiBvZiBjb21wb3VuZCBsb3NzZXMgYW5kIG1ha2Ugc3Vic2VxdWVudCBkZWNpc2lvbnMuXCIpIiwiaGludCI6IldlIHNob3VsZCB1c2UgdGhlIGVzdGltYXRlZCBwYXJhbWV0ZXJzIGZyb20gdGhlIGZyZXF1ZW5jeSBhbmQgc2V2ZXJpdHkgZGlzdHJpYnV0aW9ucyBpbiBjYWxjdWxhdGlvbiBvZiB0aGUgYWdncmVnYXRlIGNsYWltIGFtb3VudCBkaXN0cmlidXRpb24uIn0=
</div>
</div>
</div>
<div id="tweedie-distribution" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Tweedie Distribution</h2>
<p>In this section, we learn how to:</p>
<ul>
<li>Construct the Tweedie distribution from a collective risk model.</li>
<li>Establish the Tweedie distribution as a member of the exponential family of distributions.</li>
<li>Fit Tweedie distribution as a generalized linear model.</li>
</ul>
<hr />
<div id="video-tweedie-distribution" class="section level4 unnumbered">
<h4>Video: Tweedie Distribution</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_lxnu6a93&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_jjd6r5f9" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-tweedie-distribution-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Tweedie Distribution (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect54A')">A. Tweedie Distribution</button>
<button class="tablinks" onclick="openTab(event, 'Sect54B')">B. Tweedie Distribution with Exposure</button>
<button class="tablinks" onclick="openTab(event, 'Sect54C')">C. Distribution Function for Tweedie Distribution</button>
<button class="tablinks" onclick="openTab(event, 'Sect54D')">D. Example</button>
<button class="tablinks" onclick="openTab(event, 'Sect54E')">E. Example - R Code</button>
</div>
<div id="Sect54A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=41" width="100%" height="400"> </iframe>
</div>
<div id="Sect54B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=42" width="100%" height="400"> </iframe>
</div>
<div id="Sect54C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=43" width="100%" height="400"> </iframe>
</div>
<div id="Sect54D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=45" width="100%" height="400"> </iframe>
</div>
<div id="Sect54E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=46" width="100%" height="400"> </iframe>
</div>
</div>
<div id="exercise.-fitting-a-tweedie-distribution" class="section level3" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Exercise. Fitting a Tweedie Distribution</h3>
<p><img src = "ContributorPics/hurdler.png" width = "65" height = "65" style = "float:right; margin-left: 10px; margin-top: 7px" /></p>
<p><strong>Assignment Text</strong></p>
<p>In this assignment, we fit a Tweedie model for a collective risk model using observed compound losses in LGPIF data with <code>R</code>. Unlike the previous tutorials that required separate model fitting for the frequency and severity components, use of the Tweedie distribution enables us to fit a collective risk model in a single step.</p>
<div class="blackbox">
<p><strong>Instructions</strong></p>
<ul>
<li>Restrict the sample to the subset of towns and identify the total claim severity as a global variable <span class="math inline">\(S\)</span>.</li>
<li>Construct a function to determine the negative log-likelihood. Do this based on the hybrid probability mass/density function <a href="https://www.rdocumentation.org/packages/tweedie/versions/2.3.3/topics/Tweedie">dtweedie()</a>. This is a built-in function from <code>R</code> library <a href="https://cran.r-project.org/web/packages/tweedie/tweedie.pdf">tweedie</a> .</li>
<li>From the fitted Tweedie model via <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/optim">optim()</a>, extract the estimated <code>mu</code>, <code>phi</code>, and <code>p</code>.</li>
<li>After estimating the parameters of the Tweedie model, plot the empirical quantiles against the quantiles from the fitted model. Note that we generate the fitted quantiles via <a href="https://www.rdocumentation.org/packages/tweedie/versions/2.3.3/topics/Tweedie">qtweedie()</a> and the estimated Tweedie parameters.</li>
</ul>
</div>
<p><br></p>
<div data-datacamp-exercise="" data-height="300" data-encoded="true">
eyJsYW5ndWFnZSI6InIiLCJwcmVfZXhlcmNpc2VfY29kZSI6Ikluc2FtcGxlIDwtIHJlYWQuY3N2KFwiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL09wZW5BY3RUZXh0cy9MREFDb3Vyc2UxL21haW4vRGF0YS9JbnNhbXBsZS5jc3ZcIiwgaGVhZGVyPVQsIG5hLnN0cmluZ3M9YyhcIi5cIiksIHN0cmluZ3NBc0ZhY3RvcnM9RkFMU0UpXG5saWJyYXJ5KGxtZTQpXG5cbnNvdXJjZShcImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9PcGVuQWN0VGV4dHMvTERBQ291cnNlMS9tYWluL1JDb2RlL1R3ZWVkaWVTb3VyY2VDb2RlLlJtZFwiKSIsInNhbXBsZSI6Ikluc2FtcGxlVG93biA8LSBzdWJzZXQoSW5zYW1wbGUsIFR5cGVUb3duPT0xKVxuUyA8LSA/PyR5XG4jIFRoZSBuZWdhdGl2ZSBMb2cgLSBsaWtlbGlob29kXG5jb21wbG9zc19saWsgPC0gZnVuY3Rpb24ocGFybSkge1xuICBtdSAgICA8LSBwYXJtWzFdXG4gIHBoaSAgIDwtIHBhcm1bMl1cbiAgcCAgICAgPC0gcGFybVszXVxuICBsaWsgIDwtIC1zdW0oIGxvZyhkdHdlZWRpZShTLCBtdT1tdSwgcGhpPXBoaSwgcG93ZXI9ID8/KSkgKVxuICByZXR1cm4obGlrKSB9XG5pbml0LnBhcm0uY29tcGxvc3MgPC0gYyggbWVhbihTKSwgMzAwLCAxLjUpICAgICMgaW5pdGlhbCBlc3RpbWF0ZXMgXG4jIE1heGltdW0gbGlrZWxpaG9vZCBlc3RpbWF0aW9uIGZvciB0aGUgY29tcG91bmQgbG9zcyBtb2RlbFxuY29tcGxvc3NfbW9kIDwtIG9wdGltKHBhcj0/PywgIGZuPT8/LCBtZXRob2Q9XCJMLUJGR1MtQlwiKSBcblxubXUuZXN0ICA8LSBjb21wbG9zc19tb2QkcGFyWzFdXG5waGkuZXN0IDwtIGNvbXBsb3NzX21vZCQ/P1xucC5lc3QgICA8LSBjb21wbG9zc19tb2QkPz9cblxucGN0IDwtIHNlcSgwLjAxLDAuOTksMC4wMSlcbnBsb3QocXR3ZWVkaWUocGN0LCBtdT0/PywgcGhpPT8/LCBwb3dlcj1wLmVzdCkgLHF1YW50aWxlKEluc2FtcGxlVG93biR5LCBwcm9icz1wY3QpLCB4bGFiPVwiRml0dGVkIFF1YW50aWxlXCIsIHlsYWI9XCJFbXBpcmljYWwgUXVhbnRpbGVcIiwgeGxpbT1jKDAsNTAwMDApLCB5bGltPWMoMCw1MDAwMCkpXG5hYmxpbmUoMCwxKSIsInNvbHV0aW9uIjoiSW5zYW1wbGVUb3duIDwtIHN1YnNldChJbnNhbXBsZSwgVHlwZVRvd249PTEpXG5TIDwtIEluc2FtcGxlVG93biR5XG4jIFRoZSBuZWdhdGl2ZSBMb2cgLSBsaWtlbGlob29kXG5jb21wbG9zc19saWsgPC0gZnVuY3Rpb24ocGFybSkge1xuICBtdSAgICA8LSBwYXJtWzFdXG4gIHBoaSAgIDwtIHBhcm1bMl1cbiAgcCAgICAgPC0gcGFybVszXVxuICBsaWsgIDwtIC1zdW0oIGxvZyhkdHdlZWRpZShTLCBtdT1tdSwgcGhpPXBoaSwgcG93ZXI9cCkpIClcbiAgcmV0dXJuKGxpaykgfVxuaW5pdC5wYXJtLmNvbXBsb3NzIDwtIGMoIG1lYW4oUyksIDMwMCwgMS41KSAgICAjIGluaXRpYWwgZXN0aW1hdGVzIFxuIyBNYXhpbXVtIGxpa2VsaWhvb2QgZXN0aW1hdGlvbiBmb3IgdGhlIGNvbXBvdW5kIGxvc3MgbW9kZWxcbmNvbXBsb3NzX21vZCA8LSBvcHRpbShwYXI9aW5pdC5wYXJtLmNvbXBsb3NzLCBmbj1jb21wbG9zc19saWssIG1ldGhvZD1cIkNHXCIpIFxubXUuZXN0ICA8LSBjb21wbG9zc19tb2QkcGFyWzFdXG5waGkuZXN0IDwtIGNvbXBsb3NzX21vZCRwYXJbMl1cbnAuZXN0ICAgPC0gY29tcGxvc3NfbW9kJHBhclszXVxuXG5wY3QgPC0gc2VxKDAuMDEsMC45OSwwLjAxKVxucGxvdChxdHdlZWRpZShwY3QsIG11PW11LmVzdCwgcGhpPXBoaS5lc3QsIHBvd2VyPXAuZXN0KSAscXVhbnRpbGUoSW5zYW1wbGVUb3duJHksIHByb2JzPXBjdCksIHhsYWI9XCJGaXR0ZWQgUXVhbnRpbGVcIiwgeWxhYj1cIkVtcGlyaWNhbCBRdWFudGlsZVwiLCB4bGltPWMoMCw1MDAwMCksIHlsaW09YygwLDUwMDAwKSlcbmFibGluZSgwLDEpIiwic2N0IjoiU21zZyA8LSBcIkRpZCB5b3UgY29ycmVjdGx5IHNwZWNpZnkgdGhlIG9iamVjdCBgU2A/XCJcbmV4KCkgJT4lIGNoZWNrX29iamVjdChcIlNcIiwgdW5kZWZpbmVkX21zZyA9IFwiTWFrZSBzdXJlIHRvIG5vdCByZW1vdmUgYFNgIVwiKSAlPiUgY2hlY2tfZXF1YWwoaW5jb3JyZWN0X21zZz1TbXNnKVxuY29tcGxvc3NfbW9kbXNnIDwtIFwiRGlkIHlvdSBjb3JyZWN0bHkgc3BlY2lmeSB0aGUgb2JqZWN0IGBjb21wbG9zc19tb2RgP1wiXG5leCgpICU+JSBjaGVja19vYmplY3QoXCJjb21wbG9zc19tb2RcIiwgdW5kZWZpbmVkX21zZyA9IFwiTWFrZSBzdXJlIHRvIG5vdCByZW1vdmUgYGNvbXBsb3NzX21vZGAhXCIpICU+JSBjaGVja19lcXVhbChpbmNvcnJlY3RfbXNnPWNvbXBsb3NzX21vZG1zZylcbnAuZXN0bXNnIDwtIFwiRGlkIHlvdSBjb3JyZWN0bHkgc3BlY2lmeSB0aGUgb2JqZWN0IGBwLmVzdGA/XCJcbmV4KCkgJT4lIGNoZWNrX29iamVjdChcInAuZXN0XCIsIHVuZGVmaW5lZF9tc2cgPSBcIk1ha2Ugc3VyZSB0byBub3QgcmVtb3ZlIGBwLmVzdGAhXCIpICU+JSBjaGVja19lcXVhbChpbmNvcnJlY3RfbXNnPXAuZXN0bXNnKVxuc3VjY2Vzc19tc2coXCJMYXN0IHR1dG9yaWFsIGV4ZXJjaXNlLiBXZWxsIGRvbmUhIENvbXBhcmUgdG8gdGhlIG1vZGVsIGNvbnN0cnVjdGVkIGluIHR3byBwYXJ0cywgdGhlIFR3ZWVkaWUgaGFzIGZldyBwYXJhbWV0ZXJzLiBUaGlzIG1lYW5zIGl0IG1heSBub3QgZml0IGFzIHdlbGwgZm9yIHNvbWUgZGF0YXNldHMsIGVzcGVjaWFsbHkgdGhvc2VzIHdpdGggbG9uZ2VyIHRhaWxzLiBIb3dldmVyLCB0aGUgZmV3IHBhcmFtZXRlcnMgbWVhbnMgdGhhdCBpdCBpcyBlYXNpZXIgdG8gaW50cmVwcmV0LiBGdXJ0aGVyLCB0aGlzIHNpbXBsaWNpdHkgb2YgcGFyYW1ldGVycyBjYW4gYmVjb21lIHZlcnkgaW1wb3J0YW50IHdoZW4gaW50cm9kdWNpbmcgY292YXJpYXRlcy9yYXRpbmcgZmFjdG9ycyBpbnRvIHRoZSBtb2RlbGluZyBwcm9jZXNzLlwiKSIsImhpbnQiOiJGb3IgVHdlZWRpZSBkaXN0cmlidXRpb24sIHdlIGVzdGltYXRlIHRocmVlIHBhcmFtZXRlcnMgKG11LCBwaGksIHApIHRoYXQgZXhwbGFpbiB0aGUgb3ZlcmFsIG1lYW4sIGRpc3BlcnNpb24sIGFuZCBzaGFwZSBvZiB0aGUgZGlzdHJpYnV0aW9uLiJ9
</div>
</div>
</div>
<div id="effects-of-coverage-modifications" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> Effects of Coverage Modifications</h2>
<hr />
<p>In this section, we learn how to:</p>
<ul>
<li>Examine the impact of aggregate deductible on the aggregate loss.</li>
<li>Examine the effect of per-occurrence deductible on frequency and severity components in the aggregate loss.</li>
</ul>
<hr />
<div id="video-effects-of-coverage-modifications" class="section level4 unnumbered">
<h4>Video: Effects of Coverage Modifications</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_ux66n6m1&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_t0nnom35" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-effects-of-coverage-modifications-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Effects of Coverage Modifications (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect55A')">A. Aggregate Deductible</button>
<button class="tablinks" onclick="openTab(event, 'Sect55B')">B. Per-occurrence Deductible</button>
<button class="tablinks" onclick="openTab(event, 'Sect55C')">C. Per-occurrence Deductible and Frequency</button>
<button class="tablinks" onclick="openTab(event, 'Sect55D')">D. Example</button>
<button class="tablinks" onclick="openTab(event, 'Sect55E')">E. Per-occurrence Deductible</button>
</div>
<div id="Sect55A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=51" width="100%" height="400"> </iframe>
</div>
<div id="Sect55B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=53" width="100%" height="400"> </iframe>
</div>
<div id="Sect55C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=54" width="100%" height="400"> </iframe>
</div>
<div id="Sect55D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=56" width="100%" height="400"> </iframe>
</div>
<div id="Sect55E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=58" width="100%" height="400"> </iframe>
</div>
</div>
</div>
<div id="contributors-5" class="section level2 unnumbered">
<h2>Contributors</h2>
<ul>
<li><strong>Authors</strong>. <strong>Himchan Jeong</strong>, Simon Fraser University, and <strong>Peng Shi</strong>, University of Wisconsin-Madison, are the principal authors of the initial version of this chapter.</li>
<li><strong>Chapter Maintainers</strong>. Please contact Himchan <a href="mailto:himchan_jeong@sfu.ca" class="email">himchan_jeong@sfu.ca</a> and/or Jed at <a href="mailto:jfrees@bus.wisc.edu" class="email">jfrees@bus.wisc.edu</a> for chapter comments and suggested improvements.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-selection-and-estimation.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
